<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tannenhof ‚Äì Tidrapport</title>

<style>
:root{
  --green:#225b30;
  --green-dark:#163e21;
  --ink:#082410;
  --bg:#f4f7f5;
  --card:#ffffff;
  --shadow:0 6px 18px rgba(0,0,0,.12);
  --radius:16px;
}

/* layout */
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui}
.appbar{
  position:sticky;top:0;z-index:20;
  background:var(--green);
  color:#fff;
  padding:12px 16px;
  box-shadow:var(--shadow);
}
.appbar h1{margin:0;font-size:20px;font-weight:800}
.appbar small{font-size:13px;opacity:.85}

/* top buttons */
.top-buttons{display:flex;gap:8px;margin-top:12px}
.btn{
  padding:10px 14px;
  background:#fff;
  border:0;
  border-radius:12px;
  font-weight:700;
  box-shadow:var(--shadow);
}
.btn-dark{
  background:var(--green-dark);
  color:#fff;
}

/* total box */
.total-box{
  background:var(--card);
  margin:14px;
  padding:14px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;justify-content:space-between;
  font-weight:700;
  font-size:18px;
}

/* table */
.table-wrap{overflow-x:auto;margin:0 0 120px}
table{width:900px;border-collapse:separate;border-spacing:0}
thead th{
  background:#eaf4ec;
  padding:10px;
  font-size:14px;
  text-align:left;
  position:sticky;top:60px;z-index:5;
}
tbody td{padding:8px;border-bottom:1px solid #d9e6db}
input[type=time],input[type=text]{
  width:100%;padding:8px;border-radius:10px;border:2px solid #dce7dd;
  font-size:15px;
}
.today{background:#e8f9ee!important}

/* fab */
.fab{
  position:fixed;left:16px;bottom:16px;z-index:30;
  width:60px;height:60px;display:grid;place-items:center;
  border-radius:18px;border:0;
  background:rgba(34,91,48,.85);
  backdrop-filter:blur(6px);
  color:#fff;font-size:26px;box-shadow:var(--shadow);
}

/* flyout action menu */
.action-wrap{position:relative}
.action-btn{
  width:46px;height:46px;
  background:var(--green-dark);
  border-radius:12px;
  color:#fff;border:0;
  display:grid;place-items:center;
}
.action-menu{
  position:absolute;right:0;top:-150%;
  background:#fff;padding:8px;border-radius:14px;
  box-shadow:var(--shadow);display:none;flex-direction:column;gap:6px;
}
.action-wrap.open .action-menu{display:flex}
.action-menu button{
  width:42px;height:42px;border-radius:10px;border:0;
  background:var(--green);color:#fff;display:grid;place-items:center
}
.bubble{position:absolute;top:-6px;right:-6px;background:#c51313;color:#fff;width:18px;height:18px;border-radius:50%;font-size:11px;display:grid;place-items:center}

/* modal */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.4);
  display:none;place-items:center;z-index:50;
}
.modal.open{display:grid}
.sheet{
  background:#fff;width:92vw;max-width:480px;max-height:90vh;
  overflow:auto;border-radius:20px;padding:18px;box-shadow:var(--shadow)
}
.sheet h3{margin:0 0 10px}
textarea{width:100%;height:160px;border-radius:12px;border:2px solid #dce7dd;padding:10px;font-size:15px}

/* watermark */
.wm{
  position:fixed;bottom:0;right:0;width:260px;opacity:.3;pointer-events:none
}

@media print{
 .appbar,.fab,.modal,.top-buttons,.wm{display:none!important}
 body{background:#fff}
 .table-wrap{margin:0}
}
</style>
</head>
<body>

<div class="appbar">
  <h1 id="title">TH√úRINGER TANNENHOF</h1>
  <small id="subtitle">november 2025</small>
  <div class="top-buttons">
    <button id="shareBtn" class="btn">üì§ Dela / Skicka</button>
    <button id="printBtn" class="btn-dark">üñ®Ô∏è Skriv ut / PDF</button>
  </div>
</div>

<div class="total-box">
  <span>‚è≥ Totalt</span>
  <span id="grandTotal">0.00</span>
</div>

<div class="table-wrap">
<table id="tbl">
<thead>
<tr><th>Dag</th><th>Fr√•n</th><th>Till</th><th>Paus</th><th>Totalt</th><th>Projekt</th><th></th></tr>
</thead>
<tbody id="rows"></tbody>
</table>
</div>

<button class="fab" id="settingsBtn">‚öôÔ∏è</button>

<!-- Notes -->
<div class="modal" id="noteModal">
 <div class="sheet">
   <h3 id="noteTitle"></h3>
   <textarea id="noteArea" placeholder="Anteckning‚Ä¶"></textarea>
   <div style="margin-top:10px;display:flex;justify-content:flex-end">
     <button class="btn-dark" id="saveNote">Spara</button>
   </div>
 </div>
</div>

<!-- Settings -->
<div class="modal" id="settingsModal">
 <div class="sheet">
  <h3>Inst√§llningar</h3>
  <label>F√∂retag<br><input id="company" class="t" value="TH√úRINGER TANNENHOF"></label><br><br>
  <label>Spr√•k<br><select id="lang"><option value="sv">Svenska</option><option value="de">Deutsch</option><option value="en">English</option></select></label><br><br>
  <label>M√•nad<br><select id="month"></select></label><br><br>
  <label>√Ör<br><select id="year"></select></label><br><br>
  <button class="btn-dark" id="applySet">Spara & st√§ng</button>
 </div>
</div>

<img src="" id="wm" class="wm">

<script>
/* ==== SETTINGS ==== */
const M = ["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"];
const S = JSON.parse(localStorage.getItem("tnh_settings")||"{}");
let y=S.year||new Date().getFullYear();
let m=S.month||new Date().getMonth();
let comp=S.comp||"TH√úRINGER TANNENHOF";

document.getElementById("company").value=comp;
const yearSel=document.getElementById("year");
for(let i=y-1;i<=y+2;i++){
  yearSel.innerHTML+=`<option value="${i}"${i===y?"selected":""}>${i}</option>`;
}
const monthSel=document.getElementById("month");
M.forEach((v,i)=>monthSel.innerHTML+=`<option value="${i}"${i===m?"selected":""}>${v}</option>`);

function saveSettings(){
  comp=document.getElementById("company").value;
  y=Number(yearSel.value); m=Number(monthSel.value);
  localStorage.setItem("tnh_settings",JSON.stringify({comp,year:y,month:m}));
  location.reload();
}
document.getElementById("applySet").onclick=saveSettings;

/* ==== UI SET ==== */
document.getElementById("title").textContent=comp;
document.getElementById("subtitle").textContent=`${M[m]} ${y}`;

/* ==== BUILD DAYS ==== */
const rows=document.getElementById("rows");
const days=new Date(y,m+1,0).getDate();

for(let d=1;d<=days;d++){
 const tr=document.createElement("tr");
 tr.dataset.d=d;
 const today=new Date();
 if(today.getFullYear()===y && today.getMonth()===m && today.getDate()===d){
   tr.classList.add("today");
 }
 tr.innerHTML=`
  <td>${d}</td>
  <td><input type="time" data-f="f"></td>
  <td><input type="time" data-f="t"></td>
  <td><input type="time" data-f="b" value="00:00"></td>
  <td id="sum-${d}">0.00</td>
  <td><input type="text" data-f="p"></td>
  <td>
    <div class="action-wrap">
      <button class="action-btn">‚ãÆ</button>
      <div class="action-menu">
        <button data-note="${d}">üìù</button>
      </div>
    </div>
  </td>`;
 rows.appendChild(tr);
}

/* ==== NOTES ==== */
let curDay=null;
const nm=document.getElementById("noteModal");
document.getElementById("saveNote").onclick=()=>{
 localStorage.setItem(`tnh_note_${y}_${m}_${curDay}`,document.getElementById("noteArea").value);
 nm.classList.remove("open");
};

rows.addEventListener("click",e=>{
 const n=e.target.closest("[data-note]");
 if(n){
  curDay=n.dataset.note;
  document.getElementById("noteTitle").textContent=`Dag ${curDay}`;
  document.getElementById("noteArea").value=localStorage.getItem(`tnh_note_${y}_${m}_${curDay}`)||"";
  nm.classList.add("open");
 }
 if(e.target.classList.contains("action-btn")){
   const wrap=e.target.closest(".action-wrap");
   wrap.classList.toggle("open");
 }
});

/* ==== SAVE & RESTORE ==== */
function k(){return`tnh_data_${y}_${m}`;}
function save(){
 const obj={};
 rows.querySelectorAll("tr").forEach(tr=>{
  const d=tr.dataset.d;
  obj[d]={};
  tr.querySelectorAll("[data-f]").forEach(i=>{
    obj[d][i.dataset.f]=i.value;
  });
 });
 localStorage.setItem(k(),JSON.stringify(obj));
}
function restore(){
 const obj=JSON.parse(localStorage.getItem(k())||"{}");
 rows.querySelectorAll("tr").forEach(tr=>{
  const d=tr.dataset.d;
  if(obj[d]){
    tr.querySelectorAll("[data-f]").forEach(i=>{i.value=obj[d][i.dataset.f]||i.value});
  }
 });
}
restore();

/* ==== CALC ==== */
function mins(v){if(!v) return 0;let[a,b]=v.split(":").map(Number);return a*60+b}
function calc(){
 let total=0;
 rows.querySelectorAll("tr").forEach(tr=>{
  const d=tr.dataset.d;
  const f=tr.querySelector('[data-f="f"]').value;
  const t=tr.querySelector('[data-f="t"]').value;
  const b=tr.querySelector('[data-f="b"]').value||"00:00";
  let m=mins(t)-mins(f)-mins(b);
  if(m<0)m+=1440;
  const h=(m/60).toFixed(2);
  document.getElementById(`sum-${d}`).textContent=h;
  total+=Number(h);
 });
 document.getElementById("grandTotal").textContent=total.toFixed(2);
}
rows.addEventListener("input",()=>{save();calc()});
calc();

/* ==== SETTINGS BTN ==== */
document.getElementById("settingsBtn").onclick=()=>document.getElementById("settingsModal").classList.add("open");

/* ==== SHARE ==== */
document.getElementById("shareBtn").onclick=()=>navigator.share?.({title:"Tidrapport",url:location.href});

/* ==== PRINT ==== */
function fallbackPrint(){
 const w=window.open("","_blank");
 const html=document.documentElement.cloneNode(true);
 html.querySelector(".appbar")?.remove();
 html.querySelector(".fab")?.remove();
 html.querySelectorAll(".modal")?.forEach(m=>m.remove());
 w.document.write("<html>"+html.innerHTML+"</html>");
 w.document.close();
 w.onload=()=>{w.focus();w.print()};
}
function tryPrint(){
 try{window.print();}catch(e){fallbackPrint()}
 setTimeout(()=>fallbackPrint(),400);
}
document.getElementById("printBtn").onclick=tryPrint;

/* ==== CLOSE MODALS ==== */
window.onclick=e=>{
 if(e.target.classList.contains("modal")) e.target.classList.remove("open")
};
</script>
</body>
</html>
