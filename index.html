<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Th√ºringer Tannenhof ‚Äì Tidsrapport</title>
<meta name="theme-color" content="#1e6b3a">
<style>
/* === BASF√ÑRGER === */
:root{
  --bg:#f6fbf7; --ink:#103b22; --ink2:#2a5a42;
  --brand:#1e6b3a; --brandD:#0f4026; --ring:#cfe3d6;
  --chip:#f0f6f2; --row:#ffffff; --head:#e8f2ea;
  --radius:14px; --headerH:64px;
}

/* === KAMOUFLAGE-TEMA === */
body[data-theme="camo"]{
  --bg:#eef3ef; --ink:#0f2318; --ink2:#1b3a28;
  --brand:#385038; --brandD:#263823; --head:#dde7df; --chip:#eaf1ea;
  background:
    radial-gradient(circle at 20% 25%, #6f8b6a 0 19%, transparent 20%),
    radial-gradient(circle at 75% 20%, #3f5a41 0 16%, transparent 17%),
    radial-gradient(circle at 70% 75%, #556b52 0 22%, transparent 23%),
    radial-gradient(circle at 25% 80%, #879a7e 0 18%, transparent 19%),
    #eef3ef;
  background-attachment:fixed;
}

/* === GRUND === */
html,body{margin:0;background:var(--bg);color:var(--ink);
font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;}
*{box-sizing:border-box}

/* === HEADER === */
header{position:sticky;top:0;z-index:10;
background:linear-gradient(180deg,var(--brand),var(--brandD));color:#fff}
.bar{display:flex;align-items:center;gap:.7rem;padding:.8rem .9rem;
max-width:1000px;margin:0 auto}
.brand{display:flex;align-items:center;gap:.6rem;min-width:0}
.brand img{width:32px;height:32px;border-radius:8px;object-fit:cover;background:#fff}
.brand h1{margin:0;font-size:1.05rem;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.spacer{flex:1}
.btn{border:0;border-radius:16px;padding:.55rem .85rem;background:#fff;color:#132;
font-weight:800;display:flex;gap:.5rem;align-items:center}
.btn.dark{background:#0e1913;color:#fff}

/* === HUVUDTABELL === */
main{max-width:1000px;margin:10px auto;padding:0 10px}
.summary{background:#eef6ef;border-radius:18px;padding:12px 14px;margin:10px 0 16px;
display:flex;justify-content:space-between;align-items:center;
box-shadow:0 8px 24px rgba(0,0,0,.06)}
.tableWrap{overflow-x:auto;-webkit-overflow-scrolling:touch;touch-action:pan-x pan-y}
.table{position:relative;background:#fff;border-radius:18px;overflow:hidden;
box-shadow:0 10px 30px rgba(0,0,0,.07);min-width:860px}

/* === KOLUMLABELS === */
.thead,.row{display:grid;grid-template-columns:64px 1fr 1fr 120px 120px 1.2fr 126px;gap:10px;align-items:center}
.thead{background:var(--head);color:var(--ink2);font-weight:800;padding:10px 12px;
position:sticky;top:calc(var(--headerH) + 6px);z-index:3}
/* Patch: st√§ng av sticky p√• mobil */
@media (max-width:600px){.thead{position:static;top:auto;z-index:1}}

.row{padding:10px 12px;border-top:1px solid #eef2ee;background:#fff}
.num{display:inline-grid;place-items:center;width:48px;height:48px;border-radius:14px;background:var(--chip);font-weight:800;border:1px solid var(--ring)}
.pill{height:48px;display:flex;align-items:center;justify-content:center;gap:.5rem;background:var(--chip);border:1px solid var(--ring);border-radius:14px;cursor:pointer;font-weight:800}
.value{font-variant-numeric:tabular-nums}
.tot{font-weight:900;text-align:center}
.chip{display:flex;align-items:center;gap:.45rem;background:var(--chip);border-radius:12px;border:1px solid var(--ring);padding:.5rem .6rem}
.project{width:100%;border:0;background:transparent;font-weight:700;outline:none}
.actions{display:flex;gap:.45rem;justify-content:flex-end}
.act{width:48px;height:48px;border-radius:12px;background:var(--brand);color:#fff;display:grid;place-items:center;border:0;font-size:1.1rem;cursor:pointer}

/* === DAGMARKERING === */
.row.today{outline:3px solid var(--brand);background:linear-gradient(90deg,#edf6f0,transparent 40%)}

/* === WATERMARK === */
.wm{pointer-events:none;position:absolute;right:8px;bottom:8px;width:min(38vw,220px);max-width:220px;aspect-ratio:1/1;z-index:0}
.wm img{width:100%;height:100%;object-fit:contain;opacity:.9}

.bottomSpacer{height:120px}

/* === INST√ÑLLNINGAR-KNAPP === */
.fab{position:fixed;left:16px;bottom:16px;width:70px;height:70px;border-radius:22px;background:var(--brand);color:#cfe8d8;border:0;display:grid;place-items:center;box-shadow:0 12px 28px rgba(0,0,0,.28);z-index:6;font-size:1.4rem}

/* === MODALER === */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:20;padding:10px}
.sheet{width:min(600px,92vw);background:#fff;border-radius:20px;padding:18px;border:1px solid #dfeae3;box-shadow:0 20px 60px rgba(0,0,0,.28)}
.close{float:right;border:0;background:#0f1a14;color:#fff;border-radius:12px;padding:.4rem .7rem;cursor:pointer}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.field label{font-size:.9rem;color:#335846;display:block;margin-bottom:6px;font-weight:800}
.field input,.field select{width:100%;border:1px solid #d7e6dc;border-radius:12px;padding:.6rem .7rem;font-size:1rem;background:#f7fbf7}
.range{display:flex;align-items:center;gap:.7rem}

/* === KAMERA-SHEET === */
.sheet-cam-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:40}
.sheet-cam{position:fixed;left:0;right:0;bottom:0;background:#fff;border-radius:18px 18px 0 0;padding:14px 14px 18px;box-shadow:0 -18px 40px rgba(0,0,0,.25)}
.sheet-cam h3{text-align:center;margin:4px 0 10px}
.sheet-cam .btns{display:grid;gap:10px}
.sheet-cam .btn{border:0;border-radius:14px;padding:14px 16px;font-weight:800;font-size:1rem}
.sheet-cam .p1{background:var(--brand);color:#fff}
.sheet-cam .p2{background:#eaf3ec;color:#1b3f2a;border:1px solid #d3e6db}
.sheet-cam .p3{background:#f6faf7;color:#2f5e48;border:1px dashed #cfe0d6}
.sheet-cam .cancel{margin-top:8px;background:#0f1a14;color:#fff}
</style>
</head>
<body>
<header id="hdr">
  <div class="bar">
    <div class="brand"><img id="logo" alt=""><h1 id="title">üå≤ Th√ºringer Tannenhof ‚Äì Tidsrapport</h1></div>
    <div class="spacer"></div>
    <button class="btn" id="shareBtn">üì§ Dela / Skicka</button>
    <button class="btn dark" id="pdfBtn">üñ®Ô∏è PDF</button>
  </div>
</header>

<main>
  <div class="summary"><b>‚è≥ Totalt ‚Äì <span id="monthLabel"></span></b><div id="grandTotal">0.00</div></div>
  <div class="tableWrap">
    <div class="table" id="table">
      <div class="thead"><div>üìÖ Dag</div><div>‚è∞ Fr√•n</div><div>‚è∞ Till</div><div>‚òï Paus</div><div>üßÆ Totalt</div><div>üìç Projekt/plats</div><div>üí¨ √Ötg√§rd</div></div>
      <div id="rows"></div>
      <div class="bottomSpacer"></div>
      <div class="wm"><img id="wmImg" alt=""></div>
    </div>
  </div>
</main>

<button class="fab" id="fab">‚öôÔ∏è</button>

<!-- Inst√§llningsf√∂nster -->
<div class="modal" id="modal">
  <div class="sheet">
    <button class="close" id="closeModal">St√§ng</button>
    <h2>‚öôÔ∏è Inst√§llningar</h2>
    <div class="grid2">
      <div class="field"><label>F√∂retagsnamn</label><input id="company" type="text" placeholder="TH√úRINGER TANNENHOF"></div>
      <div class="field"><label>Spr√•k</label><select id="lang"><option value="sv">Svenska</option><option value="de">Deutsch</option><option value="en">English</option></select></div>
      <div class="field"><label>Tidsv√§ljare</label><select id="timePickerMode"><option value="system">Samsung/System</option><option value="custom">Appens egna</option></select></div>
      <div class="field"><label>Minutsteg</label><div class="range"><input id="stepRange" type="range" min="1" max="60" value="15"><input id="stepNum" type="number" min="1" max="60" value="15" style="width:70px"><span>min</span></div></div>
      <div class="field"><label>Vattenst√§mpel</label><div class="range"><input id="wmRange" type="range" min="0" max="100" value="70"><span id="wmVal">70%</span></div></div>
      <div class="field"><label>Byt logga</label><input id="logoFile" type="file" accept="image/*"></div>
      <div class="field"><label>Tema</label><select id="theme"><option value="green">Gr√∂nt (standard)</option><option value="camo">Milit√§r kamouflage</option></select></div>
    </div>
  </div>
</div>

<!-- Kamera/Galleri -->
<div id="camSheetOv" class="sheet-cam-overlay">
  <div class="sheet-cam">
    <h3>L√§gg till foto</h3>
    <div class="btns">
      <button class="btn p1" id="btnCamTake">üì∑ Kamera</button>
      <button class="btn p2" id="btnCamPick">üñºÔ∏è Galleri</button>
      <button class="btn p3" id="btnCamView">üëÄ Visa senaste foto</button>
      <button class="btn cancel" id="btnCamClose">St√§ng</button>
    </div>
  </div>
</div>
<input id="pickCamera" type="file" accept="image/*" capture="environment" hidden>
<input id="pickGallery" type="file" accept="image/*" hidden>

<script>
/* --- Bygg tabell (kortare version) --- */
const tbody=document.getElementById("rows");
const daysInMonth=(y,m)=>new Date(y,m+1,0).getDate();
const fmt=n=>n.toFixed(2);
function buildRows(){
  const now=new Date();const y=now.getFullYear(),m=now.getMonth();const dMax=daysInMonth(y,m);
  tbody.innerHTML="";
  for(let d=1;d<=dMax;d++){
    const row=document.createElement("div");row.className="row";row.dataset.day=d;
    row.innerHTML=`
    <div class="num">${d}</div>
    <div class="pill" data-time="from"><span>‚è∞</span><span class="value">--:--</span></div>
    <div class="pill" data-time="to"><span>‚è∞</span><span class="value">--:--</span></div>
    <div class="pill" data-time="break"><span>‚òï</span><span class="value">00:00</span></div>
    <div class="tot">0.00</div>
    <div class="chip">üìç <input class="project" type="text" placeholder="Projekt/plats"></div>
    <div class="actions"><button class="act noteBtn">üìù</button><button class="act camBtn">üì∑</button></div>`;
    tbody.appendChild(row);
  }
}
buildRows();

/* --- Samsung/systemtid via <input type=time> --- */
async function pickTimeSystem(){
  return new Promise(resolve=>{
    const input=document.createElement("input");
    input.type="time";input.style.position="fixed";input.style.left="-9999px";
    document.body.appendChild(input);
    input.onchange=()=>{resolve(input.value);input.remove()};
    input.click();
  });
}

/* --- Klick p√• tider --- */
tbody.addEventListener("click",async e=>{
  const pill=e.target.closest("[data-time]");
  if(!pill)return;
  const val=await pickTimeSystem();
  if(val)pill.querySelector(".value").textContent=val;
});

/* --- Kamera --- */
const camOv=document.getElementById("camSheetOv");
document.getElementById("btnCamClose").onclick=()=>camOv.style.display="none";
document.getElementById("btnCamTake").onclick=()=>document.getElementById("pickCamera").click();
document.getElementById("btnCamPick").onclick=()=>document.getElementById("pickGallery").click();
tbody.addEventListener("click",e=>{
  if(e.target.closest(".camBtn"))camOv.style.display="block";
});

/* --- Inst√§llningar --- */
const modal=document.getElementById("modal");
document.getElementById("fab").onclick=()=>modal.style.display="flex";
document.getElementById("closeModal").onclick=()=>modal.style.display="none";

/* --- Watermark preview --- */
document.getElementById("logoFile").addEventListener("change",e=>{
  const f=e.target.files[0];if(!f)return;const r=new FileReader();
  r.onload=()=>document.getElementById("wmImg").src=r.result;r.readAsDataURL(f);
});

/* --- Headerh√∂jd fix f√∂r sticky --- */
const setHeaderOffset=()=>document.documentElement.style.setProperty("--headerH",document.getElementById("hdr").offsetHeight+"px");
setHeaderOffset();
new ResizeObserver(()=>setHeaderOffset()).observe(document.getElementById("hdr"));
</script>
</body>
</html>
