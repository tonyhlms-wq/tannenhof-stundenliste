<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title id="tTitle">Tannenhofs tidtabell</title>
<style>
:root{
  --green:#2f6b3a; --green2:#1f5a2b;
  --bg:#f4f8f4; --ring:#cfe7d2; --text:#233223; --muted:#6b7a6b;
  --card:#fff; --maxw:980px; --r:16px; --shadow:0 8px 28px rgba(9,30,66,.08);
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
header{background:var(--green);color:#fff}
.bar{max-width:var(--maxw);margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:10px;font-weight:700}
.logo{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;background:#1e4d2a}
main{max-width:var(--maxw);margin:0 auto;padding:14px}
.wrap{display:grid;grid-template-columns:320px 1fr;gap:18px}
@media (max-width:860px){.wrap{grid-template-columns:1fr}}
.card{background:var(--card);border:1.5px solid var(--ring);border-radius:var(--r);box-shadow:var(--shadow)}
.panel{padding:14px}
.field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
label{font-size:.92rem;color:var(--muted)}
input,select,button{font-size:16px}
input[type="text"],input[type="time"],select{padding:12px;border:1.5px solid var(--ring);border-radius:12px;background:#fff}
.btn{border:none;border-radius:12px;padding:12px 14px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
.btn.primary{background:var(--green);color:#fff}
.btn.ghost{background:#fff;color:var(--green);border:1.5px solid var(--ring)}
.btn.block{width:100%}
.btn-row{display:flex;gap:8px;flex-wrap:wrap}
.small{font-size:.85rem;color:var(--muted)}
.gridHead,
.row{display:grid;grid-template-columns:68px 1fr 1fr 1fr 1fr;gap:10px;align-items:center}
.gridHead{padding:0 8px 8px 8px;color:var(--muted);font-size:.9rem}
.row{padding:10px;margin:10px 0;background:#fff;border:1.5px solid var(--ring);border-radius:14px}
.day{font-weight:700;text-align:center}
.total{background:#f8fbf8}
.sumBox{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
hr.sep{border:none;border-top:1px solid var(--ring);margin:14px 0}
footer{max-width:var(--maxw);margin:22px auto 28px;color:var(--muted);padding:0 14px}
.badge{display:inline-block;background:#e9f5ec;color:#1c5a2a;border:1px solid #cce8d1;padding:3px 8px;border-radius:999px;font-size:.8rem}
</style>
</head>
<body>
<header><div class="bar"><div class="logo" id="logoBox">ðŸŒ²</div><div id="hTitle">Tannenhofs tidtabell</div></div></header>

<main class="wrap">
  <!-- VÃ„NSTER -->
  <section class="card panel">
    <div class="field"><label id="lCompany">FÃ¶retag</label><input id="company" type="text" placeholder="THÃœRINGER TANNENHOF"></div>
    <div class="field">
      <label id="lLogo">Logga (bild eller emoji)</label>
      <input id="logoText" type="text" placeholder="t.ex. ðŸŒ² eller ðŸ¦Œ">
      <input id="logoFile" type="file" accept="image/*">
      <div class="small" id="lLocal">Sparas lokalt pÃ¥ den hÃ¤r enheten.</div>
    </div>

    <div class="field"><label id="lLang">SprÃ¥k</label>
      <select id="lang">
        <option value="sv">Svenska</option>
        <option value="de">Deutsch</option>
        <option value="en">English</option>
      </select>
    </div>

    <div class="btn-row">
      <button class="btn ghost" id="btnShare">Dela / Skicka</button>
      <button class="btn primary" id="btnPrint">Skriv ut / PDF</button>
      <button class="btn ghost" id="btnQR">QR-kod</button>
    </div>

    <hr class="sep">

    <div class="field"><label id="lMonth">MÃ¥nad</label><select id="month"></select></div>
    <div class="field"><label id="lYear">Ã…r</label><select id="year"></select></div>
    <button class="btn primary block" id="btnGen">Skapa dagar</button>

    <div class="field">
      <span class="badge" id="fillTitle">Snabbifyll</span>
      <div class="btn-row" style="margin-top:8px">
        <button class="btn ghost" id="btnFill">07:00â€“16:00 / 0:30 (vardagar)</button>
        <button class="btn ghost" id="btnClear">Rensa allt</button>
      </div>
    </div>

    <div class="field"><label><input type="checkbox" id="autosave"> <span id="lAutosave">Autospara (av)</span></label></div>
  </section>

  <!-- HÃ–GER -->
  <section>
    <div class="gridHead">
      <div id="hDay">Dag</div><div id="hFrom">FrÃ¥n</div><div id="hTo">Till</div><div id="hBreak">Paus (h:mm)</div><div id="hTotal">Totalt (h)</div>
    </div>
    <div id="rows"></div>
    <div class="card panel" style="margin-top:12px">
      <div class="sumBox">
        <div><b id="hSum">Summa:</b> <span id="sum">0.00</span> h</div>
        <div><b id="hLongest">LÃ¤ngsta dag:</b> <span id="longest">0.00</span> h</div>
      </div>
    </div>
  </section>
</main>

<footer>Â© <span id="yNow"></span> Tony HolmstrÃ¶m</footer>

<script>
/* -------- sprÃ¥k -------- */
const T={
  sv:{title:"Tannenhofs tidtabell",company:"FÃ¶retag",logo:"Logga (bild eller emoji)",local:"Sparas lokalt pÃ¥ den hÃ¤r enheten.",lang:"SprÃ¥k",
      share:"Dela / Skicka",print:"Skriv ut / PDF",qr:"QR-kod",
      month:"MÃ¥nad",year:"Ã…r",gen:"Skapa dagar",
      quick:"Snabbifyll",quickBtn:"07:00â€“16:00 / 0:30 (vardagar)",clear:"Rensa allt",
      autosave:"Autospara",day:"Dag",from:"FrÃ¥n",to:"Till",break:"Paus (h:mm)",total:"Totalt (h)",sum:"Summa:",longest:"LÃ¤ngsta dag:"},
  de:{title:"Tannenhof Stundenliste",company:"Arbeitgeber",logo:"Logo (Datei oder Emoji)",local:"Lokal auf diesem GerÃ¤t gespeichert.",lang:"Sprache",
      share:"Teilen / Senden",print:"Drucken / PDF",qr:"QR-Code",
      month:"Monat",year:"Jahr",gen:"Tage erstellen",
      quick:"Schnell fÃ¼llen",quickBtn:"07:00â€“16:00 / 0:30 (Werktage)",clear:"Alles lÃ¶schen",
      autosave:"Autospeichern",day:"Tag",from:"Von",to:"Bis",break:"Pause (Std:Min)",total:"Gesamt (Std)",sum:"Summe:",longest:"LÃ¤ngster Tag:"},
  en:{title:"Tannenhof Timesheet",company:"Company",logo:"Logo (image or emoji)",local:"Stored locally on this device.",lang:"Language",
      share:"Share / Send",print:"Print / PDF",qr:"QR code",
      month:"Month",year:"Year",gen:"Generate days",
      quick:"Quick fill",quickBtn:"07:00â€“16:00 / 0:30 (weekdays)",clear:"Clear all",
      autosave:"Autosave",day:"Day",from:"From",to:"To",break:"Break (h:mm)",total:"Total (h)",sum:"Total:",longest:"Longest day:"}
};
const el=(s)=>document.querySelector(s);
const E={
  tTitle:el('#tTitle'), hTitle:el('#hTitle'), company:el('#company'),
  logoText:el('#logoText'), logoFile:el('#logoFile'), logoBox:el('#logoBox'),
  lang:el('#lang'), btnShare:el('#btnShare'), btnPrint:el('#btnPrint'), btnQR:el('#btnQR'),
  month:el('#month'), year:el('#year'), btnGen:el('#btnGen'),
  rows:el('#rows'), autosave:el('#autosave'), btnFill:el('#btnFill'), btnClear:el('#btnClear'),
  hDay:el('#hDay'), hFrom:el('#hFrom'), hTo:el('#hTo'), hBreak:el('#hBreak'), hTotal:el('#hTotal'),
  sum:el('#sum'), longest:el('#longest'), hSum:el('#hSum'), hLongest:el('#hLongest'),
  yNow:el('#yNow')
};
E.yNow.textContent=new Date().getFullYear();

function setLang(){
  const t=T[E.lang.value];
  el('#lCompany').textContent=t.company;
  el('#lLogo').textContent=t.logo;
  el('#lLocal').textContent=t.local;
  el('#lLang').textContent=t.lang;
  E.btnShare.textContent=t.share; E.btnPrint.textContent=t.print; E.btnQR.textContent=t.qr;
  el('#lMonth').textContent=t.month; el('#lYear').textContent=t.year; E.btnGen.textContent=t.gen;
  el('#fillTitle').textContent=t.quick; E.btnFill.textContent=t.quickBtn; E.btnClear.textContent=t.clear;
  el('#hDay').textContent=t.day; el('#hFrom').textContent=t.from; el('#hTo').textContent=t.to; el('#hBreak').textContent=t.break; el('#hTotal').textContent=t.total;
  el('#hSum').textContent=t.sum; el('#hLongest').textContent=t.longest;
  el('#lAutosave').textContent=t.autosave+(E.autosave.checked?' (pÃ¥)':' (av)');
  E.tTitle.textContent=t.title; E.hTitle.textContent=t.title;
}

/* ---- mÃ¥nad/Ã¥r ---- */
(function initMY(){
  const m=["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"];
  m.forEach((n,i)=>E.month.append(new Option(n,i)));
  const y=new Date().getFullYear();
  for(let yy=y-1; yy<=y+2; yy++) E.year.append(new Option(yy,yy));
  E.month.value=new Date().getMonth(); E.year.value=y;
})();
function daysInMonth(m,y){return new Date(Number(y),Number(m)+1,0).getDate()}

/* ---- bygg rader ---- */
function build(){
  E.rows.innerHTML='';
  const n=daysInMonth(E.month.value,E.year.value);
  for(let d=1; d<=n; d++){
    const r=document.createElement('div'); r.className='row'; r.dataset.day=d;
    r.innerHTML=`<div class="day">${d}</div>
      <input type="time" step="60" placeholder="--:--">
      <input type="time" step="60" placeholder="--:--">
      <input type="time" step="60" placeholder="00:00">
      <input class="total" type="text" placeholder="0.00" readonly>`;
    r.querySelectorAll('input[type="time"]').forEach(i=>i.addEventListener('change',()=>calcRow(r)));
    E.rows.append(r);
  }
  calcAll();
}
E.btnGen.onclick=build; build();

/* ---- berÃ¤kningar ---- */
const hm2m=hm=>!hm?0:hm.split(':').map(Number).reduce((a,b,i)=>i? a+b : a+b*60,0);
const m2h=m=> (m/60).toFixed(2);
function calcRow(r){
  const [f,t,b,tot]=r.querySelectorAll('input');
  let mins=0;
  if(f.value && t.value){ mins=Math.max(0,hm2m(t.value)-hm2m(f.value)-hm2m(b.value)); }
  tot.value=m2h(mins);
  if(E.autosave.checked) saveLocal();
  calcAll();
}
function calcAll(){
  let sum=0,longest=0;
  E.rows.querySelectorAll('.row').forEach(r=>{
    const v=Number(r.querySelectorAll('input')[3].value||0);
    sum+=v; longest=Math.max(longest,v);
  });
  E.sum.textContent=sum.toFixed(2);
  E.longest.textContent=longest.toFixed(2);
}

/* ---- snabbifyll ---- */
E.btnFill.onclick=()=>{
  const n=daysInMonth(E.month.value,E.year.value);
  for(let d=1; d<=n; d++){
    const date=new Date(Number(E.year.value),Number(E.month.value),d);
    const wd=date.getDay(); // 0 sÃ¶n, 6 lÃ¶r
    if(wd===0||wd===6) continue;
    const r=E.rows.querySelector(`.row[data-day="${d}"]`);
    const [f,t,b]=r.querySelectorAll('input[type="time"]');
    f.value='07:00'; t.value='16:00'; b.value='00:30';
    calcRow(r);
  }
  if(E.autosave.checked) saveLocal();
};

/* ---- rensa ---- */
E.btnClear.onclick=()=>{ localStorage.removeItem('tannenhof-v2'); build(); };

/* ---- sprÃ¥k/lagring ---- */
E.lang.onchange=()=>{ setLang(); if(E.autosave.checked) saveLocal(); };
E.autosave.onchange=()=>{ el('#lAutosave').textContent=T[E.lang.value].autosave+(E.autosave.checked?' (pÃ¥)':' (av)'); if(!E.autosave.checked) localStorage.removeItem('tannenhof-v2'); else saveLocal(); };
function getState(){
  const rows=[...E.rows.querySelectorAll('.row')].map(r=>{
    const [f,t,b,tot]=r.querySelectorAll('input'); return {f:f.value,t:t.value,b:b.value,tot:tot.value};
  });
  return {company:E.company.value,logoText:E.logoText.value,lang:E.lang.value,month:E.month.value,year:E.year.value,rows,autosave:E.autosave.checked};
}
function saveLocal(){ localStorage.setItem('tannenhof-v2', JSON.stringify(getState())); }
function loadLocal(){
  const raw=localStorage.getItem('tannenhof-v2'); if(!raw) return;
  const s=JSON.parse(raw);
  E.company.value=s.company||''; E.logoText.value=s.logoText||''; E.lang.value=s.lang||'sv';
  E.month.value=s.month??E.month.value; E.year.value=s.year??E.year.value; E.autosave.checked=!!s.autosave;
  setLang(); build();
  if(s.rows){ [...E.rows.querySelectorAll('.row')].forEach((r,i)=>{ const it=s.rows[i]; if(!it) return; const [f,t,b,tot]=r.querySelectorAll('input'); f.value=it.f||''; t.value=it.t||''; b.value=it.b||''; tot.value=it.tot||''; }); calcAll(); }
}
setLang(); loadLocal();

/* ---- dela/skriva ut/QR ---- */
E.btnPrint.onclick=()=>window.print();
E.btnShare.onclick=async ()=>{
  const t=T[E.lang.value];
  const lines=[];
  lines.push(`${t.month}: ${Number(E.month.value)+1}/${E.year.value}`);
  lines.push(`${t.day}  ${t.from}  ${t.to}  ${t.break}  ${t.total}`);
  E.rows.querySelectorAll('.row').forEach(r=>{
    const d=r.dataset.day.padStart?.(2,'0')||r.dataset.day;
    const [f,to,b,tot]=r.querySelectorAll('input');
    if(f.value||to.value||b.value||tot.value)
      lines.push(`${d}  ${(f.value||'--:--').padEnd(5)}  ${(to.value||'--:--').padEnd(5)}  ${(b.value||'00:00').padEnd(5)}  ${(tot.value||'0.00')}`);
  });
  lines.push(`${t.sum} ${E.sum.textContent} h`);
  const text=lines.join('\n');
  if(navigator.share){ try{ await navigator.share({title:T[E.lang.value].title,text}); }catch{} }
  else { await navigator.clipboard.writeText(text); alert('Kopierat till urklipp.'); }
};
E.btnQR.onclick=()=>{
  // skapar en QR-bild via Googles chart API med sammanstÃ¤llningen
  const t=T[E.lang.value];
  const data=`${t.title} ${Number(E.month.value)+1}/${E.year.value}\n${t.sum} ${E.sum.textContent} h`;
  const url=`https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=${encodeURIComponent(data)}`;
  const w=window.open('about:blank','qr','width=340,height=380'); w.document.write(`<img src="${url}" alt="QR" style="width:300px;height:300px;display:block;margin:20px auto;font-family:sans-serif"><p style="text-align:center">${t.title}</p>`);
};

/* ---- logo ---- */
E.logoText.oninput=()=>{ E.logoBox.textContent=E.logoText.value||'ðŸŒ²'; E.logoBox.style.backgroundImage='none'; if(E.autosave.checked) saveLocal(); }
E.logoFile.onchange=(ev)=>{ const f=ev.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ E.logoBox.style.backgroundImage=`url(${r.result})`; E.logoBox.textContent=''; if(E.autosave.checked) saveLocal(); }; r.readAsDataURL(f); };
</script>
</body>
</html>
