<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="appTitle">Tannenhofs tidtabell</title>
  <style>
    :root{
      --green:#2f6b3a;        /* samma gröna som du gillade */
      --green-2:#3e703e;
      --bg:#f4f8f4;
      --text:#243023;
      --muted:#6b7a6b;
      --card:#ffffff;
      --ring:#cfe7d2;
      --radius:14px;
      --shadow:0 6px 22px rgba(9,30,66,.08);
      --gap:10px;
      --maxw:980px;           /* SAMMA bredd överallt */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      background:var(--green);
      color:#fff;
    }
    .bar{
      max-width:var(--maxw);
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      letter-spacing:.3px;
    }
    .bar .logo{
      width:28px;height:28px;border-radius:8px;
      display:grid;place-items:center;background:#1e4d2a;
    }
    main{max-width:var(--maxw);margin:0 auto;padding:14px 12px 44px}
    .wrap{
      display:grid;
      grid-template-columns: minmax(260px, 320px) 1fr;
      gap:18px;
    }
    @media (max-width:860px){
      .wrap{grid-template-columns:1fr}
    }
    .panel{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      position:sticky; top:10px;
    }
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    label{font-size:.9rem;color:var(--muted)}
    input[type="text"], input[type="file"], select, input[type="time"], input[type="number"], textarea{
      width:100%;
      padding:11px 12px;
      border:1.5px solid var(--ring);
      border-radius:12px;
      background:#fff;
      outline:none;
    }
    input[type="time"]{padding:9px 10px}
    .row{
      background:var(--card);
      border:1.5px solid var(--ring);
      border-radius:14px;
      box-shadow:var(--shadow);
      padding:10px;
      margin-bottom:10px;
      display:grid;
      grid-template-columns: 60px 1fr 1fr 1fr 1fr;
      gap:10px;
      align-items:center;
    }
    .row small{color:var(--muted)}
    .row .day{font-weight:600;text-align:center}
    .btn{
      border:none;background:var(--green);color:#fff;
      padding:12px 14px;border-radius:12px;font-weight:700;
      box-shadow:var(--shadow); cursor:pointer;
    }
    .btn.secondary{background:#fff;color:var(--green);border:1.5px solid var(--ring)}
    .btn.block{width:100%}
    .btn-group{display:flex;gap:8px;flex-wrap:wrap}
    .hint{font-size:.8rem;color:var(--muted)}
    .switch{display:flex;align-items:center;gap:8px;margin-top:6px}
    .switch input{accent-color:var(--green)}
    .grid-head{
      display:grid;
      grid-template-columns: 60px 1fr 1fr 1fr 1fr;
      gap:10px; padding:0 6px 6px 6px;
      color:var(--muted); font-size:.85rem;
    }
    footer{max-width:var(--maxw);margin:24px auto;color:var(--muted);font-size:.9rem;padding:0 12px}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="logo">🌲</div>
      <div id="titleText">Tannenhofs tidtabell</div>
    </div>
  </header>

  <main class="wrap">
    <!-- VÄNSTER PANEL -->
    <section class="panel">
      <div class="field">
        <label id="lblCompany">Företag</label>
        <input id="company" type="text" placeholder="THÜRINGER TANNENHOF" />
      </div>

      <div class="field">
        <label id="lblLogo">Logga (bild eller emoji)</label>
        <input id="logoText" type="text" placeholder="t.ex. 🌲 eller 🦌" />
        <input id="logoFile" type="file" accept="image/*" />
        <div class="hint" id="hintLocal">Sparas lokalt på den här enheten.</div>
      </div>

      <div class="field">
        <label id="lblLang">Språk</label>
        <select id="lang">
          <option value="sv">Svenska</option>
          <option value="de">Deutsch</option>
          <option value="en">English</option>
        </select>
      </div>

      <div class="btn-group">
        <button id="btnShare" class="btn secondary">Dela / Skicka</button>
        <button id="btnPrint" class="btn">Skriv ut / PDF</button>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid var(--ring)">

      <div class="field">
        <label id="lblMonth">Månad</label>
        <select id="month"></select>
      </div>
      <div class="field">
        <label id="lblYear">År</label>
        <select id="year"></select>
      </div>
      <button id="btnDays" class="btn block">Skapa dagar</button>

      <div class="switch">
        <input id="autosave" type="checkbox">
        <label for="autosave" id="lblAutosave">Autospara (av)</label>
      </div>
      <button id="btnClear" class="btn secondary block" style="margin-top:8px">Rensa allt</button>
    </section>

    <!-- HÖGER: DAGAR -->
    <section>
      <div class="grid-head">
        <div id="thDay">Dag</div>
        <div id="thFrom">Från</div>
        <div id="thTo">Till</div>
        <div id="thBreak">Paus (h:mm)</div>
        <div id="thTotal">Totalt (h)</div>
      </div>
      <div id="days"></div>
      <div class="panel" style="margin-top:14px">
        <div class="btn-group">
          <div><b id="sumHoursLbl">Summa:</b> <span id="sumHours">0.00</span> h</div>
          <div><b id="longestLbl">Längsta dag:</b> <span id="longest">0.00</span> h</div>
        </div>
      </div>
    </section>
  </main>

  <footer>© <span id="yearNow"></span> Tony Holmström</footer>

<script>
/* --------- Översättningar --------- */
const i18n = {
  sv:{
    title:"Tannenhofs tidtabell", company:"Företag", logo:"Logga (bild eller emoji)",
    hintLocal:"Sparas lokalt på den här enheten.", language:"Språk",
    share:"Dela / Skicka", print:"Skriv ut / PDF",
    month:"Månad", year:"År", gen:"Skapa dagar",
    day:"Dag", from:"Från", to:"Till", break:"Paus (h:mm)", total:"Totalt (h)",
    autosave:"Autospara", sum:"Summa:", longest:"Längsta dag:"
  },
  de:{
    title:"Tannenhof Stundenliste", company:"Arbeitgeber", logo:"Logo (Datei oder Emoji)",
    hintLocal:"Lokal auf diesem Gerät gespeichert.", language:"Sprache",
    share:"Teilen / Senden", print:"Drucken / PDF",
    month:"Monat", year:"Jahr", gen:"Tage erstellen",
    day:"Tag", from:"Von", to:"Bis", break:"Pause (Std:Min)", total:"Gesamt (Std)",
    autosave:"Autospeichern", sum:"Summe:", longest:"Längster Tag:"
  },
  en:{
    title:"Tannenhof Timesheet", company:"Company", logo:"Logo (image or emoji)",
    hintLocal:"Stored locally on this device.", language:"Language",
    share:"Share / Send", print:"Print / PDF",
    month:"Month", year:"Year", gen:"Generate days",
    day:"Day", from:"From", to:"To", break:"Break (h:mm)", total:"Total (h)",
    autosave:"Autosave", sum:"Total:", longest:"Longest day:"
  }
};

const els = {
  appTitle: qs('#appTitle'), titleText: qs('#titleText'),
  company: qs('#company'), logoText: qs('#logoText'), logoFile: qs('#logoFile'),
  hintLocal: qs('#hintLocal'), lang: qs('#lang'),
  btnShare: qs('#btnShare'), btnPrint: qs('#btnPrint'),
  month: qs('#month'), year: qs('#year'), btnDays: qs('#btnDays'),
  days: qs('#days'),
  autosave: qs('#autosave'), btnClear: qs('#btnClear'),
  thDay:qs('#thDay'), thFrom:qs('#thFrom'), thTo:qs('#thTo'),
  thBreak:qs('#thBreak'), thTotal:qs('#thTotal'),
  lblCompany:qs('#lblCompany'), lblLogo:qs('#lblLogo'), lblLang:qs('#lblLang'),
  lblMonth:qs('#lblMonth'), lblYear:qs('#lblYear'),
  lblAutosave:qs('#lblAutosave'),
  sumHoursLbl:qs('#sumHoursLbl'), longestLbl:qs('#longestLbl'),
  sumHours:qs('#sumHours'), longest:qs('#longest'),
  yearNow:qs('#yearNow')
};
els.yearNow.textContent = new Date().getFullYear();

/* ----- Hjälpare ----- */
function qs(s){return document.querySelector(s)}
function h(tag, attrs={}, ...kids){
  const el = document.createElement(tag);
  for(const [k,v] of Object.entries(attrs)){ if(v!==null) el.setAttribute(k,v) }
  kids.forEach(k=> el.append(k));
  return el;
}

/* ----- Init månad/år ----- */
(function initMonthYear(){
  const mNames = ["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"];
  for(let m=0;m<12;m++){ els.month.append(h('option',{value:m}, mNames[m])) }
  const y = new Date().getFullYear();
  for(let yy=y-1; yy<=y+2; yy++){ els.year.append(h('option',{value:yy}, yy)) }
  els.month.value = new Date().getMonth();
  els.year.value = y;
})();

/* ----- Skapa dagar ----- */
function daysInMonth(m,y){ return new Date(y, Number(m)+1, 0).getDate() }

function buildDays(){
  els.days.innerHTML='';
  const n = daysInMonth(els.month.value, els.year.value);
  for(let d=1; d<=n; d++){
    const row = h('div',{class:'row', 'data-day':d});
    row.append(h('div',{class:'day'}, d));
    // Tomma fält -> triggar mobilens tid-picker
    const from = h('input',{type:'time', step:60, placeholder:'--:--'});
    const to   = h('input',{type:'time', step:60, placeholder:'--:--'});
    const br   = h('input',{type:'time', step:60, placeholder:'00:00'});
    const tot  = h('input',{type:'text', placeholder:'0.00', readOnly:true});
    [from,to,br].forEach(inp=>{
      inp.addEventListener('change', ()=> calcRow(row));
    });
    row.append(from,to,br,tot);
    els.days.append(row);
  }
  calcAll();
}
els.btnDays.addEventListener('click', buildDays);
buildDays(); // första gången

/* ----- Beräkningar ----- */
function hmToMinutes(hm){
  if(!hm) return 0;
  const [h,m] = hm.split(':').map(Number);
  return (h||0)*60 + (m||0);
}
function minutesToHours(min){ return (min/60).toFixed(2) }

function calcRow(row){
  const [from,to,br,tot] = row.querySelectorAll('input');
  const f = hmToMinutes(from.value);
  const t = hmToMinutes(to.value);
  const b = hmToMinutes(br.value);
  let mins = 0;
  if(from.value && to.value){ mins = Math.max(0, t - f - b) }
  tot.value = minutesToHours(mins);
  if(els.autosave.checked) saveLocal();
  calcAll();
}
function calcAll(){
  let sum=0, longest=0;
  els.days.querySelectorAll('.row').forEach(r=>{
    const tot = r.querySelectorAll('input')[3].value;
    const v = Number(tot||0);
    sum += v; longest = Math.max(longest, v);
  });
  els.sumHours.textContent = sum.toFixed(2);
  els.longest.textContent = longest.toFixed(2);
}

/* ----- Lokal lagring (avstängd som standard) ----- */
function state(){
  const rows = [...els.days.querySelectorAll('.row')].map(r=>{
    const [from,to,br,tot] = r.querySelectorAll('input');
    return {from:from.value,to:to.value,br:br.value,tot:tot.value};
  });
  return {
    company:els.company.value, logoText:els.logoText.value,
    lang:els.lang.value, month:els.month.value, year:els.year.value,
    rows, autosave:els.autosave.checked
  }
}
function loadLocal(){
  const raw = localStorage.getItem('tannenhof-v2');
  if(!raw) return;
  const s = JSON.parse(raw);
  els.company.value = s.company||'';
  els.logoText.value = s.logoText||'';
  els.lang.value = s.lang||'sv';
  els.month.value = s.month??els.month.value;
  els.year.value = s.year??els.year.value;
  els.autosave.checked = !!s.autosave;
  applyLang();
  buildDays();
  if(s.rows){
    [...els.days.querySelectorAll('.row')].forEach((r,i)=>{
      const it=s.rows[i]; if(!it) return;
      const [from,to,br,tot]=r.querySelectorAll('input');
      from.value=it.from||''; to.value=it.to||''; br.value=it.br||''; tot.value=it.tot||'';
    });
  }
  calcAll();
}
function saveLocal(){ localStorage.setItem('tannenhof-v2', JSON.stringify(state())) }
els.autosave.addEventListener('change', ()=> {
  if(els.autosave.checked) saveLocal(); else localStorage.removeItem('tannenhof-v2');
  els.lblAutosave.textContent = tr('autosave') + (els.autosave.checked ? ' (på)' : ' (av)');
});
els.btnClear.addEventListener('click', ()=>{
  localStorage.removeItem('tannenhof-v2');
  els.company.value=''; els.logoText.value='';
  buildDays(); calcAll();
});

/* ----- Språk ----- */
function tr(key){ return i18n[els.lang.value][key] }
function applyLang(){
  const t = i18n[els.lang.value];
  els.appTitle.textContent = t.title;
  els.titleText.textContent = t.title;
  qs('#lblCompany').textContent = t.company;
  qs('#lblLogo').textContent = t.logo;
  els.hintLocal.textContent = t.hintLocal;
  qs('#lblLang').textContent = t.language;
  els.btnShare.textContent = t.share;
  els.btnPrint.textContent = t.print;
  qs('#lblMonth').textContent = t.month;
  qs('#lblYear').textContent = t.year;
  els.btnDays.textContent = t.gen;
  els.thDay.textContent = t.day;
  els.thFrom.textContent = t.from;
  els.thTo.textContent = t.to;
  els.thBreak.textContent = t.break;
  els.thTotal.textContent = t.total;
  els.sumHoursLbl.textContent = t.sum;
  els.longestLbl.textContent = t.longest;
  els.lblAutosave.textContent = t.autosave + (els.autosave.checked ? ' (på)' : ' (av)');
}
els.lang.addEventListener('change', ()=>{ applyLang(); if(els.autosave.checked) saveLocal() });

/* ----- Dela/skriva ut ----- */
els.btnPrint.addEventListener('click', ()=> window.print());
els.btnShare.addEventListener('click', async ()=>{
  const lines = [];
  lines.push(`${tr('month')}: ${Number(els.month.value)+1}/${els.year.value}`);
  lines.push(`${tr('day')}  ${tr('from')}  ${tr('to')}  ${tr('break')}  ${tr('total')}`);
  els.days.querySelectorAll('.row').forEach(r=>{
    const d=r.dataset.day;
    const [f,t,b,tot]=r.querySelectorAll('input');
    if(f.value||t.value||b.value||tot.value){
      lines.push(String(d).padStart(2,'0')+'  '+[f.value||'--:--',t.value||'--:--',b.value||'00:00',tot.value||'0.00'].join('  '));
    }
  });
  lines.push(`${tr('sum')} ${els.sumHours.textContent} h`);
  const text = lines.join('\n');
  if(navigator.share){
    try{ await navigator.share({title: i18n[els.lang.value].title, text}); }catch{}
  }else{
    await navigator.clipboard.writeText(text);
    alert('Kopierat till urklipp.');
  }
});

/* ----- Start ----- */
applyLang();
loadLocal();

/* ----- Logo (emoji eller bild) ----- */
els.logoFile.addEventListener('change', ev=>{
  const file = ev.target.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{ document.querySelector('.logo').style.backgroundImage=`url(${reader.result})` }
  reader.readAsDataURL(file);
});
els.logoText.addEventListener('input', ()=>{
  document.querySelector('.logo').textContent = els.logoText.value || '🌲';
});
</script>
</body>
</html>
