<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Thüringer Tannenhof – Tidtabell</title>
<style>
  /* ======= Färger/tema (enkelt, snabbt) ======= */
  :root{
    --primary:#1b5e37;
    --primary-2:#0f3d24;
    --card:#eaf5ef;
    --ink:#0e2418;
    --ok:#116149;
    --danger:#bb2b2b;
  }
  [data-theme="camo"]{
    --primary:#334a36;
    --primary-2:#243427;
    --card:#e7efe9;
    --ink:#132017;
    --ok:#355c3e;
  }

  /* ======= Bas ======= */
  html,body{margin:0;background:#f7faf8;color:var(--ink);
    font:16px system-ui,-apple-system,Segoe UI,Roboto,Arial; touch-action: pan-x pan-y;}
  .top{position:sticky;top:0;z-index:20;color:#fff;
    background:linear-gradient(180deg,var(--primary),var(--primary-2));
    padding:10px 12px;display:flex;align-items:center;gap:12px}
  .brand{display:flex;align-items:center;gap:10px;min-width:0}
  .logo{width:28px;height:28px;border-radius:6px;background:#fff;box-shadow:inset 0 0 0 2px rgba(0,0,0,.05)}
  .brand h1{font-size:16px;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .toolbar{margin-left:auto;display:flex;gap:10px}
  .btn{background:#fff;color:#111;border-radius:14px;padding:10px 14px;font-weight:700;border:none;
       box-shadow:0 6px 18px rgba(0,0,0,.15);display:inline-flex;gap:8px;align-items:center}
  .btn.dark{background:#111;color:#fff}

  .wrap{padding:12px}

  /* ======= Summa-kort ======= */
  .panel{background:var(--card);border-radius:16px;padding:14px 16px;box-shadow:0 10px 24px rgba(0,0,0,.08)}
  .sumrow{display:flex;align-items:center;justify-content:space-between}
  .chip{background:#fff;border-radius:12px;padding:6px 10px;box-shadow:0 3px 10px rgba(0,0,0,.08);font-weight:800}

  /* ======= EDIT-banderoll (visar vilken ruta) ======= */
  .editbar{position:sticky;top:56px;z-index:19;background:#fff;
    border-left:4px solid var(--ok);padding:8px 12px;margin:10px 0;border-radius:10px;
    box-shadow:0 6px 16px rgba(0,0,0,.06);display:none}
  .editbar.show{display:block}

  /* ======= Tabell – nu med horisontell scroll ======= */
  .hscroll{overflow:auto; -webkit-overflow-scrolling:touch; background:#fff;border-radius:16px;
           box-shadow:0 8px 24px rgba(0,0,0,.06)}
  .grid{min-width:900px;}  /* gör att man kan dra i sidled på mobil */
  .head,.row{display:grid;grid-template-columns:72px 120px 120px 120px 1fr 110px 110px;
             gap:12px;align-items:center}
  .head{position:sticky;top:106px;background:#e6f2ea;border-bottom:2px solid #d8e8df;z-index:18;
        padding:10px 12px;font-weight:800}
  .row{padding:10px 12px;border-bottom:1px solid #eef3f0}
  .cell{background:#f0f6f2;border-radius:14px;padding:10px 12px;min-height:44px;display:flex;gap:8px;align-items:center}
  .day{justify-content:center;font-weight:800;background:#eaf5ef}
  .proj{min-width:160px}
  .total{font-weight:800;background:#eff6f2}
  .act{display:flex;gap:10px;justify-content:flex-end}
  .iconbtn{width:48px;height:48px;border-radius:14px;background:var(--primary);display:grid;place-items:center;border:none;
           box-shadow:0 6px 16px rgba(0,0,0,.18)}
  .iconbtn svg{fill:#fff}

  /* Inputs */
  input[type="time"],input.tlist{all:unset;background:#fff;border:1px solid #dbe6df;border-radius:10px;
                                 padding:8px 10px;min-width:82px;text-align:center;
                                 font-variant-numeric:tabular-nums}
  .editing{outline:3px solid var(--ok);outline-offset:2px;background:#fff}

  /* flytande inställning */
  .floating{position:fixed;left:18px;bottom:18px;z-index:30}
  .settings{width:64px;height:64px;border-radius:18px;background:var(--primary);display:grid;place-items:center;border:none;
            box-shadow:0 10px 24px rgba(0,0,0,.28)}

  .padBottom{height:110px} /* sista raden syns alltid */
  dialog{border:none;border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,.35);padding:0}
  .dlg{padding:18px;min-width:300px;background:#fff;border-radius:18px}
  select,input[type="text"],input[type="range"],input[type="color"]{width:100%;padding:10px;border-radius:12px;
    border:1px solid #dbe6df;background:#f8fbf9}
  .gridForm{display:grid;gap:10px}
</style>
</head>
<body data-theme="green">
  <!-- Topp -->
  <div class="top">
    <div class="brand">
      <div class="logo" id="brandLogo"></div>
      <h1 id="brandTitle">Thüringer Tannenhof – Tidtabell</h1>
    </div>
    <div class="toolbar">
      <button class="btn" id="shareBtn">Dela / Skicka</button>
      <button class="btn dark" id="pdfBtn">PDF</button>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="sumrow">
        <div><strong>Totalt –</strong></div>
        <div class="chip" id="sumHours">0.00</div>
      </div>
    </div>

    <!-- Visar vilken ruta som är aktiv -->
    <div class="editbar" id="editbar">Redigerar: –</div>

    <!-- TABELL – kan dras i sidled -->
    <div class="hscroll">
      <div class="grid">
        <div class="head">
          <div>Dag</div><div>Från</div><div>Till</div><div>Paus</div><div>Projekt/plats</div><div>Totalt</div><div>Aktion</div>
        </div>
        <div id="rows"></div>
      </div>
    </div>
    <div class="padBottom"></div>
  </div>

  <!-- Flytande inställnings-knapp -->
  <div class="floating"><button class="settings" id="openSettings" aria-label="Inställningar">⚙️</button></div>

  <!-- Inställningar -->
  <dialog id="settingsDlg">
    <form class="dlg gridForm" method="dialog">
      <h2>Inställningar</h2>
      <label>Språk
        <select id="inpLang">
          <option value="sv">Svenska</option>
          <option value="de">Deutsch</option>
          <option value="en">English</option>
        </select>
      </label>
      <label>Tidsväljare
        <select id="inpPicker">
          <option value="system">Systemets klocka</option>
          <option value="list15">Lista (15 min)</option>
        </select>
      </label>
      <label>Tema
        <select id="inpTheme">
          <option value="green">Grönt (standard)</option>
          <option value="camo">Militär kamouflage</option>
        </select>
      </label>
      <menu style="display:flex;gap:10px;justify-content:flex-end;margin:8px 0 0 0">
        <button value="cancel">Stäng</button>
        <button id="saveBtn" value="default">Spara</button>
      </menu>
    </form>
  </dialog>

<script>
/* ==========================
   Enkel bestående lagring
   ========================== */
const STORE="tt_timesheet_v2";
const S=load()||def();

function def(){
  const rows={}; for(let d=1; d<=31; d++) rows[d]={from:"",to:"",brk:"00:00",proj:"",total:"0:00"};
  return {lang:"sv",picker:"system",theme:"green",rows};
}
function save(){ localStorage.setItem(STORE, JSON.stringify(S)); }
function load(){ try{ return JSON.parse(localStorage.getItem(STORE)||""); }catch{ return null; } }

/* ==========================
   Hjälp
   ========================== */
const $ = (q)=>document.querySelector(q);
const rowsEl = $("#rows"), sumEl=$("#sumHours"), editbar=$("#editbar");

function toMin(s){ if(!s||s==="--:--") return 0; const [h,m]=s.split(":").map(Number); return h*60+m; }
function HHMM(m){ const h=Math.floor(m/60), mm=m%60; return `${String(h).padStart(1,"0")}:${String(mm).padStart(2,"0")}`; }
function calcRow(d){ const r=S.rows[d], a=toMin(r.from), b=toMin(r.to), c=toMin(r.brk); const t=Math.max(0,b-a-c); r.total=HHMM(t); return t; }
function calcSum(){ let s=0; for(let d=1; d<=31; d++) s+=calcRow(d); sumEl.textContent=(s/60).toFixed(2); }

function build(){
  document.body.dataset.theme=S.theme;
  rowsEl.innerHTML="";
  for(let d=1; d<=31; d++){
    const r=S.rows[d]||{from:"",to:"",brk:"00:00",proj:"",total:"0:00"};

    const row=document.createElement("div"); row.className="row";

    // Dag
    const cDay=div("cell day",String(d).padStart(2,"0"));

    // Från/Till/Paus
    const cFrom=timeCell(d,"from",r.from,"Från");
    const cTo=timeCell(d,"to",r.to,"Till");
    const cBrk=timeCell(d,"brk",r.brk,"Paus", true);

    // Projekt
    const cProj=div("cell proj","");
    const pInp=document.createElement("input");
    pInp.type="text"; pInp.placeholder=labelText("proj");
    pInp.value=r.proj||"";
    pInp.oninput=()=>{ S.rows[d].proj=pInp.value; save(); };
    pInp.onfocus=()=>onStartEdit(d,"Projekt/plats",pInp.parentElement);
    pInp.onblur =()=>onEndEdit();
    cProj.append(pInp);

    // Total
    const cTot=div("cell total", r.total||"0:00");

    // Aktioner
    const cAct=document.createElement("div"); cAct.className="act";
    const clear=iconBtn(trashSvg(), ()=>{ S.rows[d]={from:"",to:"",brk:"00:00",proj:"",total:"0:00"}; save(); refreshRow(d); });
    cAct.append(clear);

    row.append(cDay,cFrom,cTo,cBrk,cProj,cTot,cAct);
    rowsEl.append(row);
  }
  calcSum();
}

/* cellbyggare */
function div(cls,txt){ const e=document.createElement("div"); e.className=cls; if(txt!=null)e.textContent=txt; return e; }
function iconBtn(svg,fn){ const b=document.createElement("button"); b.className="iconbtn"; b.innerHTML=svg; b.onclick=fn; return b;}
function trashSvg(){return `<svg width="22" height="22" viewBox="0 0 24 24"><path d="M9 3h6l1 2h4v2H4V5h4l1-2Zm1 6h2v8h-2V9Zm4 0h2v8h-2V9ZM6 9h2v8H6V9Z"/></svg>`}

/* tidscell: systemklocka eller lista */
function timeCell(day,key,value,label,isBreak=false){
  const wrap=div("cell","");
  const inp=document.createElement("input");
  if(S.picker==="system"){
    inp.type="time"; inp.step=isBreak?900:300;
  }else{
    inp.type="text"; inp.className="tlist"; inp.readOnly=true;
  }
  inp.value=value|| (S.picker==="system" ? "" : "--:--");

  // fokusmarkering + banderoll
  inp.onfocus=()=>onStartEdit(day,label,wrap);
  inp.onblur =()=>onEndEdit();

  // logik för val
  if(S.picker==="system"){
    inp.onchange=()=>{ setTime(day,key,inp.value); };
  }else{
    inp.onclick=()=>chooseFromList(inp,key,day,isBreak);
  }
  wrap.append(inp);
  return wrap;
}

function onStartEdit(day,label,cell){
  editbar.textContent=`Redigerar: Dag ${day} – ${label}`;
  editbar.classList.add("show");
  cell.classList.add("editing");
  cell.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"});
}
function onEndEdit(){
  editbar.classList.remove("show");
  document.querySelectorAll(".editing").forEach(el=>el.classList.remove("editing"));
}

function setTime(d,key,val){
  S.rows[d][key]=val;
  save(); refreshRow(d);
}

function chooseFromList(inp,key,day,isBreak){
  const list=[]; const step=isBreak?15:15;
  for(let h=0; h<24; h++){
    for(let m=0; m<60; m+=step){
      list.push(`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`);
    }
  }
  const dlg=document.createElement("dialog");
  dlg.innerHTML=`<div class="dlg" style="max-height:70vh;overflow:auto"><h3>Välj tid</h3></div>`;
  const box=dlg.firstChild;
  list.forEach(v=>{
    const b=document.createElement("button");
    b.textContent=v; b.style.display="block"; b.style.width="100%"; b.style.padding="10px";
    b.style.border="none"; b.style.background="#fff";
    b.onclick=()=>{ inp.value=v; setTime(day,key,v); dlg.close(); dlg.remove(); };
    box.append(b);
  });
  const foot=document.createElement("menu"); foot.style.display="flex"; foot.style.justifyContent="flex-end";
  const close=document.createElement("button"); close.textContent="Stäng"; close.onclick=()=>{dlg.close(); dlg.remove();};
  foot.append(close); box.append(foot);
  document.body.append(dlg); dlg.showModal();
}

/* uppdatera en rad snabbt */
function refreshRow(d){
  const idx=d-1;
  const row=rowsEl.children[idx]; if(!row) return;
  const r=S.rows[d];

  // inputs i ordning: from,to,break,proj
  const inputs=row.querySelectorAll("input");
  if(inputs[0]) inputs[0].value = S.picker==="system" ? (r.from||"") : (r.from||"--:--");
  if(inputs[1]) inputs[1].value = S.picker==="system" ? (r.to||"")   : (r.to||"--:--");
  if(inputs[2]) inputs[2].value = S.picker==="system" ? (r.brk||"00:00") : (r.brk||"00:00");
  if(inputs[3]) inputs[3].value = r.proj||"";

  // total
  row.querySelector(".total").textContent = HHMM(calcRow(d));
  calcSum();
}

/* Språk – bara rubriker / placeholders (enkelt) */
function labelText(k){
  const t={sv:{proj:"Projekt/plats"},de:{proj:"Projekt/Ort"},en:{proj:"Project/site"}};
  return (t[S.lang]||t.sv)[k];
}

/* ===== Inställningar ===== */
$("#openSettings").onclick=()=>{ $("#inpLang").value=S.lang; $("#inpPicker").value=S.picker; $("#inpTheme").value=S.theme; $("#settingsDlg").showModal(); };
$("#saveBtn").onclick=()=>{
  S.lang=$("#inpLang").value; S.picker=$("#inpPicker").value; S.theme=$("#inpTheme").value;
  save(); $("#settingsDlg").close(); build();
};

/* Stubbar för delning/pdf */
$("#shareBtn").onclick=()=>alert("Dela/Skicka – export kan kopplas senare.");
$("#pdfBtn").onclick =()=>alert("PDF – kan kopplas senare.");

build();
</script>
</body>
</html>
