<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tannenhofs tidtabell</title>
<style>
  :root{
    --bg:#f6fbf7;
    --card:#ffffff;
    --ink:#102a12;
    --muted:#3b5e42;
    --ok:#0b7a39;
    --accent:#1a4d2e;
    --camo1:#e9efe9; --camo2:#d6e2d6; --camo3:#c0d1c3; --camo4:#b4c7b7;
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.35 system-ui,Segoe UI,Roboto}
  header{background:linear-gradient(180deg,#154d2f,#0e3a23);color:#fff;padding:12px 14px;position:sticky;top:0;z-index:5}
  .bar{display:flex;align-items:center;gap:12px;max-width:900px;margin:0 auto}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700}
  .brand img{width:28px;height:28px;border-radius:6px;background:#fff;object-fit:cover}
  .btn{border:0;border-radius:18px;padding:10px 14px;background:#fff;color:#111;font-weight:700;box-shadow:0 2px 0 rgba(0,0,0,.15);display:flex;gap:8px;align-items:center}
  .btn.dark{background:#0d0d0d;color:#fff}
  main{max-width:900px;margin:14px auto;padding:0 10px}
  .total{background:#eef6ef;border-radius:18px;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;margin:10px 0 16px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
  .table{position:relative;background:var(--card);border-radius:18px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.07)}
  .thead,.row{display:grid;grid-template-columns:64px 1fr 1fr 120px 92px;gap:10px;align-items:center}
  .thead{background:#e8f2ea;color:#133a21;font-weight:800;padding:10px 12px;position:sticky;top:64px;z-index:2}
  .row{padding:12px;border-top:1px solid #eef2ee}
  .cell{display:flex;align-items:center;gap:10px}
  .badge{width:48px;height:48px;border-radius:14px;background:#f3f8f4;display:grid;place-items:center;font-weight:800}
  .pill{flex:1;background:#f3f8f4;border-radius:14px;height:48px;display:flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;position:relative}
  .pill span.value{font-variant-numeric:tabular-nums}
  .sel{width:110px}
  .act{display:flex;gap:10px;justify-content:flex-end}
  .iconbtn{width:48px;height:48px;border-radius:14px;background:#1a4d2e;color:#fff;display:grid;place-items:center;cursor:pointer}
  .todayMarker{position:absolute;left:0;top:0;bottom:0;width:6px;background:#1a7a3a;border-radius:0 6px 6px 0}
  /* Watermark */
  .wm{position:absolute;right:16px;bottom:16px;width:240px;aspect-ratio:1;background:
      radial-gradient(110px 110px at 20% 20%, var(--camo1) 0, transparent 60%),
      radial-gradient(140px 140px at 90% 30%, var(--camo2) 0, transparent 60%),
      radial-gradient(130px 130px at 50% 80%, var(--camo3) 0, transparent 60%),
      #dfe8df;border-radius:16px;display:grid;place-items:center;pointer-events:none;mix-blend-mode:multiply;opacity:.7;overflow:hidden}
  .wm img{width:78%;opacity:.9}
  /* Settings FAB */
  .fab{position:fixed;left:16px;bottom:16px;width:64px;height:64px;border-radius:18px;background:#1a4d2e;color:#cde9d7;display:grid;place-items:center;box-shadow:0 12px 28px rgba(0,0,0,.25);z-index:6;cursor:pointer}
  /* Modal base */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:20;padding:10px}
  .card{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.25)}
  /* Settings dialog */
  #dlgSettings .card{width:min(560px,92%);padding:18px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{font-size:.9rem;color:#30523a;font-weight:700}
  input[type="text"],select{width:100%;height:44px;border-radius:12px;border:1px solid #d9e6db;background:#f7fbf7;padding:0 12px}
  .rangeRow{display:flex;align-items:center;gap:12px}
  input[type="range"]{flex:1}
  .previewLogo{height:40px;object-fit:cover;border-radius:8px;background:#e9efe9;padding:4px}
  /* Time picker */
  #timePicker{display:none}
  #timePicker .card{width:320px;padding:12px;background:
      radial-gradient(circle at 20% 15%, var(--camo1) 0 30%, transparent 31%),
      radial-gradient(circle at 80% 20%, var(--camo2) 0 33%, transparent 34%),
      radial-gradient(circle at 25% 85%, var(--camo3) 0 35%, transparent 36%),
      #f4faf4}
  .clock{width:260px;height:260px;border-radius:50%;background:#fff;border:10px solid var(--camo4);position:relative;margin:8px auto;box-shadow:inset 0 0 0 3px #e6efe6}
  .tick{position:absolute;left:50%;top:50%;width:2px;height:12px;background:#97b59b;transform-origin:center -110px}
  .hand{position:absolute;left:50%;top:50%;width:2px;height:95px;background:#1a4d2e;border-radius:2px;transform-origin:bottom center}
  .hand.min{height:120px;background:#0c6a36}
  .nub{position:absolute;left:50%;top:50%;width:12px;height:12px;background:#123d24;border-radius:50%;transform:translate(-50%,-50%)}
  .tpHead{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;font-weight:800}
  .seg{display:flex;border-radius:12px;overflow:hidden;border:1px solid #c9dacd}
  .seg button{border:0;background:#eff6f0;padding:8px 10px;font-weight:800;cursor:pointer}
  .seg button.active{background:#1a4d2e;color:#fff}
  .tpBtns{display:flex;justify-content:space-between;gap:8px;margin-top:8px}
  .tpBtns .btn{flex:1}
  /* Nice sheet menu for camera */
  .sheet{position:fixed;left:0;right:0;bottom:-40%;background:#fff;border-radius:16px 16px 0 0;box-shadow:0 -20px 40px rgba(0,0,0,.25);padding:10px 14px;transition:all .28s ease;z-index:25}
  .sheet.open{bottom:0}
  .sheet h4{margin:6px 2px 10px}
  .sheet .opt{display:flex;gap:10px}
  .chip{flex:1;background:#eff6f0;border:1px solid #cfe0d3;border-radius:14px;height:54px;display:grid;place-items:center;font-weight:800;cursor:pointer}
  .thumb{width:48px;height:48px;border-radius:10px;object-fit:cover;border:1px solid #dfe7e1}
  .ghost{opacity:.35}
</style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand"><img id="brandLogo" alt="logo"/><span id="brandTitle">Tannenhofs tidtabell</span></div>
      <button class="btn" id="btnShare">üéÇ <span data-t="share">Dela / Skicka</span></button>
      <button class="btn dark" id="btnPDF">üñ®Ô∏è <span>PDF</span></button>
    </div>
  </header>

  <main>
    <div class="total">
      <div>‚è≥ <b id="totalTitle">Totalt ‚Äì oktober 2025</b></div>
      <div id="grandTotal">0.00</div>
    </div>

    <div class="table" id="table">
      <div class="thead">
        <div class="cell">üìÖ <span data-t="day">Dag</span></div>
        <div class="cell">‚è∞ <span data-t="from">Fr√•n</span></div>
        <div class="cell">‚è∞ <span data-t="to">Till</span></div>
        <div class="cell">‚òï <span data-t="break">Paus</span></div>
        <div class="cell sel" data-t="total">Totalt</div>
      </div>
      <div id="rows"></div>

      <!-- Watermark -->
      <div class="wm" id="wm"><img id="wmImg" alt="" /></div>
    </div>
  </main>

  <div class="fab" id="fab">‚öôÔ∏è</div>

  <!-- Settings dialog -->
  <div class="modal" id="dlgSettings" aria-hidden="true">
    <div class="card">
      <h3 style="margin:0 0 8px">Inst√§llningar</h3>
      <div class="grid">
        <div>
          <label>F√∂retagsnamn</label>
          <input id="inpCompany" type="text" value="TH√úRINGER TANNENHOF"/>
        </div>
        <div>
          <label>Spr√•k</label>
          <select id="selLang">
            <option value="sv">Svenska</option>
            <option value="de">Deutsch</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="rangeRow" style="grid-column:1/-1">
          <label style="min-width:140px">Vattenst√§mpel</label>
          <input id="rngWM" type="range" min="0" max="100" value="70"/>
          <span id="rngWMVal">70%</span>
        </div>
        <div>
          <label>Byt logga</label>
          <input id="logoFile" type="file" accept="image/*"/>
        </div>
        <div>
          <label>F√∂rhandsvisning</label><br/>
          <img id="logoPrev" class="previewLogo" alt=""/>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
        <button class="btn" onclick="closeDlg('dlgSettings')">St√§ng</button>
      </div>
    </div>
  </div>

  <!-- Time picker -->
  <div class="modal" id="timePicker">
    <div class="card">
      <div class="tpHead">
        <div id="tpLabel">V√§lj tid</div>
        <div class="seg">
          <button id="segHour" class="active">Tim</button>
          <button id="segMin">Min</button>
        </div>
      </div>
      <div class="clock" id="clock">
        <!-- ticks -->
        <div class="hand" id="hHand"></div>
        <div class="hand min" id="mHand"></div>
        <div class="nub"></div>
      </div>
      <div class="tpBtns">
        <button class="btn" id="tpClear">Rensa</button>
        <button class="btn" id="tpCancel">Avbryt</button>
        <button class="btn dark" id="tpOk">Ange</button>
      </div>
    </div>
  </div>

  <!-- Camera/Gallery sheet -->
  <div class="sheet" id="camSheet" aria-hidden="true">
    <h4 data-t="addphoto">L√§gg till foto</h4>
    <div class="opt">
      <div class="chip" id="chooseCam">üì∑ Kamera</div>
      <div class="chip" id="chooseGal">üñºÔ∏è Galleri</div>
      <img id="lastThumb" class="thumb ghost" alt=""/>
    </div>
    <!-- hidden inputs -->
    <input id="inCam" type="file" accept="image/*" capture="environment" hidden>
    <input id="inGal" type="file" accept="image/*" hidden>
  </div>

<script>
/* --- simple i18n --- */
const i18n={
  sv:{title:"Tannenhofs tidtabell",day:"Dag",from:"Fr√•n",to:"Till",break:"Paus",total:"Totalt",share:"Dela / Skicka",project:"Projekt/plats",addphoto:"L√§gg till foto"},
  de:{title:"Tannenhofs Zeittabelle",day:"Tag",from:"Von",to:"Bis",break:"Pause",total:"Gesamt",share:"Teilen / Senden",project:"Projekt/Ort",addphoto:"Foto hinzuf√ºgen"},
  en:{title:"Tannenhof Time Sheet",day:"Day",from:"From",to:"To",break:"Break",total:"Total",share:"Share / Send",project:"Project/site",addphoto:"Add photo"}
};
let lang='sv';
function applyLang(){
  const L=i18n[lang];
  document.querySelector('#brandTitle').textContent=L.title;
  document.querySelectorAll('[data-t="day"]').forEach(e=>e.textContent=L.day);
  document.querySelectorAll('[data-t="from"]').forEach(e=>e.textContent=L.from);
  document.querySelectorAll('[data-t="to"]').forEach(e=>e.textContent=L.to);
  document.querySelectorAll('[data-t="break"]').forEach(e=>e.textContent=L.break);
  document.querySelectorAll('[data-t="total"]').forEach(e=>e.textContent=L.total);
  document.querySelectorAll('[data-t="share"]').forEach(e=>e.textContent=L.share);
  document.querySelectorAll('.projectLabel').forEach(e=>e.textContent=L.project);
  document.querySelectorAll('[data-t="addphoto"]').forEach(e=>e.textContent=L.addphoto);
}
/* --- rows & state --- */
const rowsEl=document.getElementById('rows');
const days=new Date().getMonth()===9?31:31; // oktober 31
const state=[...Array(days)].map(()=>({from:null,to:null,break:0,photo:null}));
function pad(n){return String(n).padStart(2,'0')}
function fmt(t){return t==null?'--:--':pad(Math.floor(t/60))+':'+pad(t%60)}
function rowTpl(i){
  return `<div class="row" data-i="${i}">
    <div class="cell" style="position:relative">
      <div class="badge"> ${i+1} </div>
      <div class="todayMarker" style="display:none"></div>
    </div>
    <div class="pill pick" data-kind="from"><span>‚è∞</span><span class="value">--:--</span></div>
    <div class="pill pick" data-kind="to"><span>‚è∞</span><span class="value">--:--</span></div>
    <div class="pill">
      <select class="brSel" style="width:100%;height:100%;border:0;background:transparent;border-radius:14px;padding:0 8px;font-weight:700">
        ${[...Array(33)].map((_,k)=>`<option value="${k*15}">${pad(Math.floor((k*15)/60))+':'+pad((k*15)%60)}</option>`).join('')}
      </select>
    </div>
    <div class="act">
      <div class="iconbtn note" title="Anteckning">üìù</div>
      <div class="iconbtn cam" title="Foto">üì∏</div>
    </div>
  </div>`;
}
rowsEl.innerHTML=[...Array(days)].map((_,i)=>rowTpl(i)).join('');
/* highlight today */
const d=new Date();
const today=d.getMonth()===9?d.getDate():-1;
if(today>0){
  const r=document.querySelector(`.row[data-i="${today-1}"] .todayMarker`);
  if(r) r.style.display='block';
}
/* totals */
function recalc(){
  let sum=0;
  state.forEach((s,i)=>{
    const t=(s.from!=null&&s.to!=null)?Math.max(0,s.to-s.from - s.break):0;
    sum+=t;
    const totalCell=document.querySelector(`.row[data-i="${i}"]`);
    // put number on left column as subtle total
    totalCell.querySelector('.badge').dataset.total=(t/60).toFixed(2);
  });
  document.getElementById('grandTotal').textContent=(sum/60).toFixed(2);
}
/* bind picks */
document.querySelectorAll('.row .pick').forEach(p=>{
  const i=+p.closest('.row').dataset.i;
  p.querySelector('.value').textContent='--:--';
  p.addEventListener('click',()=>openTimePicker(i,p.dataset.kind));
});
document.querySelectorAll('.brSel').forEach((sel,idx)=>{
  sel.addEventListener('change',e=>{
    state[idx].break=+e.target.value;
    recalc();
  });
});
/* project labels localized */
function applyProjectLabels(){
  document.querySelectorAll('.projectLabel').forEach(e=>e.textContent=i18n[lang].project);
}
/* --- settings --- */
const fab=document.getElementById('fab');
fab.onclick=()=>openDlg('dlgSettings');
function openDlg(id){document.getElementById(id).style.display='flex'}
function closeDlg(id){document.getElementById(id).style.display='none'}
document.getElementById('selLang').onchange=e=>{lang=e.target.value;applyLang()}
const rng=document.getElementById('rngWM');
const rngVal=document.getElementById('rngWMVal');
rng.oninput=()=>{rngVal.textContent=rng.value+'%';document.getElementById('wm').style.opacity=(+rng.value/100)}
document.getElementById('logoFile').onchange=e=>{
  const f=e.target.files[0]; if(!f) return;
  const url=URL.createObjectURL(f);
  document.getElementById('brandLogo').src=url;
  document.getElementById('logoPrev').src=url;
  document.getElementById('wmImg').src=url;
};
/* --- watermark init --- */
document.getElementById('wmImg').src='';
/* --- time picker logic (round, light camo) --- */
let tp={row:-1,kind:'from',mode:'h',h:8,m:0};
const tpEl=document.getElementById('timePicker');
const hHand=document.getElementById('hHand');
const mHand=document.getElementById('mHand');
function drawHands(){
  hHand.style.transform=`translate(-50%,-100%) rotate(${(tp.h%12)*30 + tp.m/2}deg)`;
  mHand.style.transform=`translate(-50%,-100%) rotate(${tp.m*6}deg)`;
}
function openTimePicker(i,kind){
  tp={row:i,kind,mode:'h',h:8,m:0};
  drawHands();
  tpEl.style.display='flex';
}
function toXY(e,el){
  const r=el.getBoundingClientRect();
  return {x:e.clientX - (r.left+r.width/2), y:e.clientY - (r.top+r.height/2)};
}
const clock=document.getElementById('clock');
let dragging=false;
clock.addEventListener('pointerdown',e=>{dragging=true;clock.setPointerCapture(e.pointerId); setFromPoint(e)});
clock.addEventListener('pointermove',e=>{if(dragging)setFromPoint(e)});
clock.addEventListener('pointerup',e=>{dragging=false});
function setFromPoint(e){
  const {x,y}=toXY(e,clock);
  const ang=(Math.atan2(y,x)*180/Math.PI+450)%360;
  if(tp.mode==='h'){
    let h=Math.round(ang/30); if(h===12) h=0;
    tp.h=(new Date()).getHours()>11? (h===0?12:h):h; // we still store 0-23 later
  }else{
    tp.m=Math.round(ang/6)%60;
  }
  drawHands();
}
document.getElementById('segHour').onclick=()=>{tp.mode='h';segHour.classList.add('active');segMin.classList.remove('active')};
document.getElementById('segMin').onclick=()=>{tp.mode='m';segMin.classList.add('active');segHour.classList.remove('active')};
document.getElementById('tpCancel').onclick=()=>tpEl.style.display='none';
document.getElementById('tpClear').onclick=()=>{
  const s=state[tp.row]; s[tp.kind]=null;
  document.querySelector(`.row[data-i="${tp.row}"] .pick[data-kind="${tp.kind}"] .value`).textContent='--:--';
  tpEl.style.display='none'; recalc();
};
document.getElementById('tpOk').onclick=()=>{
  // store 24h; just use chosen h as is, let user set both ends
  const s=state[tp.row];
  const totalMin=tp.h*60+tp.m;
  s[tp.kind]=totalMin;
  document.querySelector(`.row[data-i="${tp.row}"] .pick[data-kind="${tp.kind}"] .value`).textContent=fmt(totalMin);
  tpEl.style.display='none'; recalc();
};
/* --- camera sheet --- */
let camRow=-1;
const camSheet=document.getElementById('camSheet');
function openCam(i){camRow=i;camSheet.classList.add('open')}
function closeCam(){camSheet.classList.remove('open')}
document.querySelectorAll('.iconbtn.cam').forEach((b,i)=>b.onclick=()=>openCam(i));
document.getElementById('chooseCam').onclick=()=>document.getElementById('inCam').click();
document.getElementById('chooseGal').onclick=()=>document.getElementById('inGal').click();
function handlePicked(file){
  if(!file) return; const url=URL.createObjectURL(file);
  state[camRow].photo=url;
  document.getElementById('lastThumb').src=url; document.getElementById('lastThumb').classList.remove('ghost');
  closeCam();
}
document.getElementById('inCam').onchange=e=>handlePicked(e.target.files[0]);
document.getElementById('inGal').onchange=e=>handlePicked(e.target.files[0]);
/* --- build rows initial values --- */
document.querySelectorAll('.row').forEach((r,i)=>{
  // badge click opens notes later (placeholder)
  r.querySelector('.iconbtn.note').onclick=()=>alert('Notis f√∂r dag '+(i+1));
  if(i===today-1){ r.style.background='linear-gradient(90deg,#edf6f0,transparent 40%)' }
});
/* init */
applyLang(); recalc();
/* close modals on bg click */
document.querySelectorAll('.modal').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.style.display='none'}));
</script>
</body>
</html>
