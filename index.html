<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tannenhofs tidtabell</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --brand:#2f7a3f; --brand-dark:#256333;
    --ink:#213027; --muted:#5b6b61;
    --bg:#f5f9f6; --card:#ffffff; --ring:#cfe5d6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;color:var(--ink);background:var(--bg)}
  header{position:sticky;top:0;z-index:10;background:var(--brand);color:#fff;padding:14px 18px;display:flex;gap:12px;align-items:center;box-shadow:0 2px 6px rgb(0 0 0/.08)}
  header .logo{width:28px;height:28px;border-radius:6px;display:grid;place-items:center;background:#1e5d2a;font-size:18px}
  header h1{font-size:18px;line-height:1.2;margin:0;font-weight:600}
  main{max-width:1000px;margin:18px auto;padding:0 14px 90px}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;box-shadow:0 6px 24px rgb(10 40 20/.06)}
  .toolbar{padding:12px 12px 0;display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .chip{display:inline-flex;align-items:center;gap:8px;background:#e9f3eb;border:1px solid var(--ring);padding:8px 10px;border-radius:10px}
  button{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;background:var(--brand);color:#fff;cursor:pointer}
  button.secondary{background:#e8efe9;color:#113}
  button.ghost{background:transparent;color:var(--brand);border:1px solid var(--ring)}
  button.mini{padding:8px 10px;border-radius:8px}
  button:active{transform:translateY(1px)}
  button:disabled{opacity:.5;cursor:not-allowed}
  .fab{position:fixed;right:16px;bottom:18px;z-index:20;width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:var(--brand);color:#fff;font-size:22px;box-shadow:0 12px 30px rgb(10 40 20/.22)}
  .backdrop{position:fixed;inset:0;background:rgb(0 0 0/.35);display:none;z-index:30}
  .drawer{position:fixed;right:-420px;top:0;height:100%;width:min(420px,96vw);background:var(--card);border-left:1px solid var(--ring);z-index:31;transition:right .25s ease;padding:18px;overflow:auto}
  .backdrop.show{display:block} .drawer.show{right:0}
  .set h3{margin:.4rem 0 .5rem;font-size:15px;color:var(--muted)}
  .set .row{display:grid;grid-template-columns:1fr;gap:10px;margin-bottom:12px}
  .set .inline{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  input[type="text"],input[type="time"],input[type="number"],select{width:100%;border:1px solid var(--ring);background:#fff;color:var(--ink);padding:10px 12px;border-radius:10px;font-size:15px}
  /* Sheet */
  .sheet{margin-top:14px}
  .thead,.row{display:grid;gap:8px;align-items:center}
  /* Tighter, mobile-first columns */
  .thead,.row{grid-template-columns:56px minmax(88px,1fr) minmax(88px,1fr) 96px 84px 72px}
  @media(min-width:720px){ .thead,.row{grid-template-columns:60px 1fr 1fr 110px 110px 110px} }
  .thead{padding:12px;font-weight:700;color:var(--muted)}
  .row{padding:10px 12px}
  .row input[type="time"],.row input[type="text"]{background:#fff}
  .row:nth-child(odd){background:#f8fbf9}
  .total{font-weight:700;text-align:right}
  .under{grid-column:1 / -1;margin:2px 0 -6px 0;color:var(--muted);font-size:12px}
  .tag{display:inline-block;background:#e9f3eb;border:1px solid var(--ring);padding:2px 8px;border-radius:999px;margin-left:6px}
  .footer{display:flex;gap:10px;flex-wrap:wrap;padding:14px;border-top:1px solid var(--ring);background:#fbfdfc;border-radius:0 0 14px 14px}
  .stat{padding:10px 12px;border:1px solid var(--ring);border-radius:10px;background:#fff}
  .banner{margin-bottom:12px;padding:10px 12px;background:#fff3c4;border:1px solid #f3e29a;border-radius:10px}
  /* Bottom sheet editor */
  .sheetpad{position:fixed;left:0;right:0;bottom:-100%;z-index:40;background:var(--card);border-top:1px solid var(--ring);border-radius:14px 14px 0 0;box-shadow:0 -10px 30px rgb(0 0 0/.18);transition:bottom .25s ease;max-height:92vh;display:flex;flex-direction:column}
  .sheetpad.show{bottom:0}
  .sheetpad header{position:sticky;top:0;background:var(--card);color:var(--ink);box-shadow:none;border-bottom:1px solid var(--ring)}
  .pad-body{padding:12px;overflow:auto;display:grid;gap:10px}
  textarea{width:100%;min-height:28vh;border:1px solid var(--ring);border-radius:10px;padding:10px 12px;font-size:15px;resize:vertical}
</style>
</head>
<body>

<header>
  <div class="logo" id="logoBox">üå≤</div>
  <h1 id="title">Tannenhofs tidtabell</h1>
</header>

<main>
  <div class="toolbar">
    <div class="chip">üè¢ <span id="companyLabel">TH√úRINGER TANNENHOF</span></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="ghost" id="btnShare">Dela / Skicka</button>
      <button id="btnPrint">Skriv ut / PDF</button>
    </div>
  </div>

  <div id="roBanner" class="banner" style="display:none"></div>

  <div class="card sheet">
    <div class="thead">
      <div data-i18n="day">Dag</div>
      <div data-i18n="from">Fr√•n</div>
      <div data-i18n="to">Till</div>
      <div data-i18n="break">Paus (h:mm)</div>
      <div data-i18n="total">Totalt (h)</div>
      <div data-i18n="actions">√Ötg√§rder</div>
    </div>
    <div id="rows"></div>
    <div class="footer">
      <div class="stat" id="sumBox">Œ£ 0.00 h</div>
      <div class="stat" id="maxBox">L√§ngsta dag: 0.00 h</div>
      <div class="stat" id="avgBox">Snitt: 0.00 h</div>
    </div>
  </div>
</main>

<button class="fab" id="openFab" title="Inst√§llningar">‚öôÔ∏è</button>

<div class="backdrop" id="backdrop"></div>
<aside class="drawer" id="drawer" aria-label="Inst√§llningar">
  <div class="set">
    <h2 style="margin:0 0 8px">Inst√§llningar</h2>

    <h3 data-i18n="company">F√∂retag</h3>
    <div class="row"><input id="company" type="text" placeholder="TH√úRINGER TANNENHOF"></div>

    <h3 data-i18n="logoLabel">Logga (bild eller emoji)</h3>
    <div class="row"><input id="logoEmoji" type="text" placeholder="t.ex. üå≤ eller ü¶å"><input id="logoFile" type="file" accept="image/*"></div>

    <h3 data-i18n="language">Spr√•k</h3>
    <div class="row"><select id="lang"><option value="sv">Svenska</option><option value="de">Deutsch</option><option value="en">English</option></select></div>

    <div class="inline">
      <div>
        <h3 data-i18n="month">M√•nad</h3><select id="month"></select>
      </div>
      <div>
        <h3 data-i18n="year">√Ör</h3><input id="year" type="number" min="2000" max="2100">
      </div>
    </div>

    <h3 data-i18n="quickfill">Snabbifyll (vardagar)</h3>
    <div class="inline"><input id="qFrom" type="time" value="07:00"><input id="qTo" type="time" value="16:00"></div>
    <div class="row"><label class="chip"><span data-i18n="breakShort">Paus</span><input id="qBreak" type="time" value="00:30"></label></div>
    <div class="row" style="display:flex;gap:8px">
      <button id="btnApplyQuick" class="secondary" data-i18n="applyQuick">Fyll i vardagar</button>
      <button id="btnGenerate" data-i18n="genDays">Skapa dagar</button>
    </div>

    <h3 data-i18n="autosave">Autospara</h3>
    <div class="row" style="display:flex;gap:8px;align-items:center">
      <label class="chip"><input id="autosave" type="checkbox"> <span data-i18n="autosaveLabel">(av/p√•)</span></label>
      <button id="btnClear" class="ghost" data-i18n="clearAll">Rensa allt</button>
    </div>

    <div class="row"><button id="closeDrawer" class="ghost" data-i18n="close">St√§ng</button></div>
  </div>
</aside>

<!-- Bottom sheet note/project editor -->
<div class="backdrop" id="padBackdrop" style="z-index:39;display:none"></div>
<div class="sheetpad" id="pad">
  <header>
    <div style="display:flex;align-items:center;gap:10px;padding:12px">
      <strong id="padTitle">Dag</strong>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button id="padCancel" class="ghost">Avbryt</button>
        <button id="padSave">Spara</button>
      </div>
    </div>
  </header>
  <div class="pad-body">
    <label><strong>Projekt / Plats</strong><input id="padProject" type="text" placeholder="t.ex. Gran√•kern, Sektion B"></label>
    <label><strong>Anteckning</strong><textarea id="padNote" placeholder="Skriv fritt‚Ä¶"></textarea></label>
  </div>
</div>

<script>
/* i18n */
const I18N={sv:{title:"Tannenhofs tidtabell",day:"Dag",from:"Fr√•n",to:"Till",break:"Paus (h:mm)",total:"Totalt (h)",actions:"√Ötg√§rder",company:"F√∂retag",logoLabel:"Logga (bild eller emoji)",language:"Spr√•k",month:"M√•nad",year:"√Ör",genDays:"Skapa dagar",quickfill:"Snabbifyll (vardagar)",applyQuick:"Fyll i vardagar",breakShort:"Paus",autosave:"Autospara",autosaveLabel:"(av/p√•)",clearAll:"Rensa allt",close:"St√§ng",share:"Dela / Skicka",print:"Skriv ut / PDF",readonly:"Skrivskyddad vy (delad l√§nk).",edit:"Redigera"},de:{title:"Tannenhof Stundenliste",day:"Tag",from:"Von",to:"Bis",break:"Pause (Std:Min)",total:"Gesamt (Std)",actions:"Aktionen",company:"Arbeitgeber",logoLabel:"Logo (Bild oder Emoji)",language:"Sprache",month:"Monat",year:"Jahr",genDays:"Tage erstellen",quickfill:"Schnell ausf√ºllen (Werktage)",applyQuick:"Werktage f√ºllen",breakShort:"Pause",autosave:"Autom. Speichern",autosaveLabel:"(aus/an)",clearAll:"Alles l√∂schen",close:"Schlie√üen",share:"Teilen / Senden",print:"Drucken / PDF",readonly:"Schreibgesch√ºtzte Ansicht (geteilter Link).",edit:"Bearbeiten"},en:{title:"Tannenhof Timesheet",day:"Day",from:"From",to:"To",break:"Break (h:mm)",total:"Total (h)",actions:"Actions",company:"Company",logoLabel:"Logo (image or emoji)",language:"Language",month:"Month",year:"Year",genDays:"Generate days",quickfill:"Quick fill (weekdays)",applyQuick:"Fill weekdays",breakShort:"Break",autosave:"Autosave",autosaveLabel:"(off/on)",clearAll:"Clear all",close:"Close",share:"Share / Send",print:"Print / PDF",readonly:"Read-only view (shared link).",edit:"Edit"}};
const MONTHS={sv:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],de:["Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};
/* DOM */
const $=(id)=>document.getElementById(id);
const els={title:$('title'),logoBox:$('logoBox'),companyLabel:$('companyLabel'),rows:$('rows'),sumBox:$('sumBox'),maxBox:$('maxBox'),avgBox:$('avgBox'),btnPrint:$('btnPrint'),btnShare:$('btnShare'),roBanner:$('roBanner'),backdrop:$('backdrop'),drawer:$('drawer'),openFab:$('openFab'),closeDrawer:$('closeDrawer'),company:$('company'),logoEmoji:$('logoEmoji'),logoFile:$('logoFile'),lang:$('lang'),month:$('month'),year:$('year'),btnGenerate:$('btnGenerate'),autosave:$('autosave'),btnClear:$('btnClear'),qFrom:$('qFrom'),qTo:$('qTo'),qBreak:$('qBreak'),btnApplyQuick:$('btnApplyQuick'),pad:$('pad'),padBackdrop:$('padBackdrop'),padTitle:$('padTitle'),padProject:$('padProject'),padNote:$('padNote'),padSave:$('padSave'),padCancel:$('padCancel')};
/* State */
const state={lang:localStorage.getItem('tf_lang')||'sv',company:localStorage.getItem('tf_company')||'TH√úRINGER TANNENHOF',logoEmoji:localStorage.getItem('tf_logoEmoji')||'üå≤',logoImg:localStorage.getItem('tf_logoImg')||null,month:+(localStorage.getItem('tf_month')??(new Date().getMonth())),year:+(localStorage.getItem('tf_year')??(new Date().getFullYear())),autosave:localStorage.getItem('tf_autosave')==='1',rows:JSON.parse(localStorage.getItem('tf_rows')||'[]'),readonly:false,editIndex:null};
/* URL import (read-only) */
(function(){const h=location.hash.slice(1);if(!h)return;try{Object.assign(state,JSON.parse(decodeURIComponent(atob(h))));state.readonly=true;}catch{}})();
/* Helpers */
function tkey(k){return I18N[state.lang][k]||k}
function daysInMonth(y,m){return new Date(y,m+1,0).getDate()}
function toHours(hm){if(!hm)return 0;const[a,b]=hm.split(':').map(Number);return a+(b/60)}
function span(a,b){if(!a||!b)return 0;const[ah,am]=a.split(':').map(Number),[bh,bm]=b.split(':').map(Number);return (bh+bm/60)-(ah+am/60)}
function calcRow(r){return Math.max(0,+(span(r.from,r.to)-toHours(r.brk)).toFixed(2))}
function saveRows(){localStorage.setItem('tf_rows',JSON.stringify(state.rows))}
function applyHeader(){els.companyLabel.textContent=state.company;if(state.logoImg){els.logoBox.style.backgroundImage=`url(${state.logoImg})`;els.logoBox.style.backgroundSize='cover';els.logoBox.textContent='';}else{els.logoBox.style.backgroundImage='';els.logoBox.textContent=state.logoEmoji||'üå≤';}}
/* i18n apply */
function applyI18n(){document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');const v=tkey(k);if(v)el.textContent=v;});document.title=tkey('title');$('title').textContent=tkey('title');els.month.innerHTML=MONTHS[state.lang].map((m,i)=>`<option value="${i}">${m}</option>`).join('');}
/* Drawer */
(function bindDrawer(){
  const open=()=>{els.backdrop.classList.add('show');els.drawer.classList.add('show')}
  const close=()=>{els.backdrop.classList.remove('show');els.drawer.classList.remove('show')}
  els.openFab.onclick=open;els.closeDrawer.onclick=close;els.backdrop.onclick=close;
  els.lang.onchange=()=>{state.lang=els.lang.value;localStorage.setItem('tf_lang',state.lang);applyI18n();render()}
  els.company.oninput=()=>{state.company=els.company.value;localStorage.setItem('tf_company',state.company);applyHeader()}
  els.logoEmoji.oninput=()=>{state.logoEmoji=els.logoEmoji.value;localStorage.setItem('tf_logoEmoji',state.logoEmoji);state.logoImg=null;localStorage.removeItem('tf_logoImg');applyHeader()}
  els.logoFile.onchange=(e)=>{const f=e.target.files[0];if(!f)return;const rd=new FileReader();rd.onload=()=>{state.logoImg=rd.result;localStorage.setItem('tf_logoImg',state.logoImg);applyHeader()};rd.readAsDataURL(f)}
  els.month.onchange=()=>{state.month=+els.month.value;localStorage.setItem('tf_month',state.month)}
  els.year.oninput=()=>{state.year=+els.year.value;localStorage.setItem('tf_year',state.year)}
  els.autosave.onchange=()=>{state.autosave=els.autosave.checked;localStorage.setItem('tf_autosave',state.autosave?'1':'0')}
  els.btnGenerate.onclick=()=>generateDays()
  els.btnApplyQuick.onclick=()=>applyQuick()
  els.btnClear.onclick=()=>{if(!confirm('Rensa alla tider?'))return;state.rows=[];saveRows();renderRows()}
})();
function generateDays(){const n=daysInMonth(state.year,state.month);const next=[];for(let d=1;d<=n;d++){const old=state.rows.find(r=>r.day===d);next.push(old||{day:d,from:"",to:"",brk:"",note:"",project:""})}state.rows=next;saveRows();renderRows()}
function applyQuick(){const f=els.qFrom.value,t=els.qTo.value,b=els.qBreak.value;state.rows=state.rows.map(r=>{const wd=new Date(state.year,state.month,r.day).getDay();if(wd>=1&&wd<=5){return {...r,from:f,to:t,brk:b}}return r});saveRows();renderRows()}
/* Editor (bottom sheet) */
function openPad(idx){state.editIndex=idx;const r=state.rows[idx];els.padTitle.textContent=`${tkey('edit')} ‚Äì ${tkey('day')} ${r.day}`;els.padProject.value=r.project||"";els.padNote.value=r.note||"";els.padBackdrop.style.display='block';els.pad.classList.add('show')}
function closePad(){els.padBackdrop.style.display='none';els.pad.classList.remove('show');state.editIndex=null}
els.padCancel.onclick=closePad;els.padBackdrop.onclick=closePad;
els.padSave.onclick=()=>{const i=state.editIndex;if(i==null)return;state.rows[i].project=els.padProject.value;state.rows[i].note=els.padNote.value;if(state.autosave)saveRows();renderRows();closePad()}
function renderRows(){els.rows.innerHTML='';state.rows.forEach((r,i)=>{const row=document.createElement('div');row.className='row';row.innerHTML=`
  <div>
    ${r.day}
    ${r.project?`<span class="tag">${r.project}</span>`:''}
  </div>
  <div><input ${state.readonly?'disabled':''} data-k="from" type="time" value="${r.from||''}"></div>
  <div><input ${state.readonly?'disabled':''} data-k="to" type="time" value="${r.to||''}"></div>
  <div><input ${state.readonly?'disabled':''} data-k="brk" type="time" value="${r.brk||''}"></div>
  <div class="total" id="t${i}">${calcRow(r).toFixed(2)}</div>
  <div><button class="mini" ${state.readonly?'disabled':''} data-edit="${i}">üìù</button></div>
`; row.querySelectorAll('input').forEach(inp=>{inp.oninput=()=>{const k=inp.getAttribute('data-k');state.rows[i][k]=inp.value;document.getElementById('t'+i).textContent=calcRow(state.rows[i]).toFixed(2);if(state.autosave)saveRows();renderStats();};}); row.querySelector('[data-edit]').onclick=()=>openPad(i); els.rows.appendChild(row);}); renderStats()}
function renderStats(){let sum=0,max=0,count=0;state.rows.forEach(r=>{const v=calcRow(r);if(v>0){sum+=v;max=Math.max(max,v);count++}});const avg=count?(sum/count):0;els.sumBox.textContent=`Œ£ ${sum.toFixed(2)} h`;els.maxBox.textContent=`${state.lang==='de'?'L√§ngster Tag:':state.lang==='en'?'Longest day:':'L√§ngsta dag:'} ${max.toFixed(2)} h`;els.avgBox.textContent=`${state.lang==='de'?'Durchschnitt:':state.lang==='en'?'Average:':'Snitt:'} ${avg.toFixed(2)} h`}
/* Print & Share */
$('btnPrint').onclick=()=>window.print();
$('btnShare').onclick=async()=>{const payload={lang:state.lang,company:state.company,logoEmoji:state.logoEmoji,logoImg:state.logoImg,month:state.month,year:state.year,rows:state.rows};const hash=btoa(encodeURIComponent(JSON.stringify(payload)));const url=location.origin+location.pathname+'#'+hash;try{if(navigator.share){await navigator.share({title:tkey('title'),text:state.company,url});return}}catch{}const qr=`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(url)}`;try{await navigator.clipboard.writeText(url)}catch{};const w=window.open('','_blank');w.document.write(`<title>${tkey('title')}</title><body style="font-family:system-ui;padding:20px"><h2>${tkey('title')}</h2><p>${state.company}</p><p><a href="${url}">${url}</a></p><img alt="QR" src="${qr}"></body>`)}
/* Readonly banner */
function applyReadonly(){if(state.readonly){els.roBanner.style.display='';els.roBanner.textContent=tkey('readonly');els.openFab.style.display='none'}}
/* Boot */
(function boot(){applyI18n();applyHeader();els.lang.value=state.lang;els.company.value=state.company;els.logoEmoji.value=state.logoEmoji;els.month.value=state.month;els.year.value=state.year;els.autosave.checked=state.autosave;if(state.rows.length===0)generateDays();else renderRows();applyReadonly()})();
</script>
</body>
</html>
