<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Th√ºringer Tannenhof ‚Äì Tidsrapport</title>
<style>
:root{
  --brand:#1f5634;         /* Byts i Inst√§llningar */
  --brand-900:#173f27;
  --brand-700:#1b4b2e;
  --brand-50:#eef5f0;
  --ink:#0f1a14;
  --muted:#6b7a71;
  --bg:#f3f7f4;
  --card:#ffffff;
  --line:#e2ebe5;
  --focus:#0a7a5d;
  --radius:16px;
  --shadow:0 8px 24px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color:var(--ink);
  background:var(--bg);
}

/* Top bar */
.header{
  position:sticky; top:0; z-index:20;
  background:linear-gradient(180deg,var(--brand),var(--brand-900));
  color:#fff;
  padding:10px env(safe-area-inset-left) 10px env(safe-area-inset-right);
  box-shadow:0 6px 16px rgba(0,0,0,.18);
}
.header-inner{
  display:flex; align-items:center; gap:12px; max-width:980px; margin:0 auto;
}
.logo-badge{
  width:36px; height:36px; border-radius:999px; overflow:hidden;
  display:grid; place-items:center; background:#eaf3ee; color:var(--brand);
  font-weight:700;
}
.logo-badge img{width:100%; height:100%; object-fit:cover}
.header-title{flex:1; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.header-actions{display:flex; gap:10px}
.btn{
  appearance:none; border:0; cursor:pointer;
  border-radius:14px; padding:10px 16px; font-weight:700;
  background:#fff; color:var(--ink); box-shadow:var(--shadow);
}
.btn-dark{ background:rgba(0,0,0,.25); color:#fff}

/* Summary bar */
.summary{
  max-width:980px; margin:14px auto 8px; display:grid; grid-template-columns:1fr 1fr auto; gap:12px;
  padding:0 12px;
}
.card{
  background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px;
}
.shadowless{box-shadow:none; background:transparent; padding:0}
.hint{color:var(--muted); font-size:12px}
.nav-arrows{display:flex; gap:8px}
.iconbtn{
  width:44px; height:44px; border-radius:12px; border:0; background:var(--brand-50); color:var(--brand); font-weight:900; cursor:pointer;
}
.iconbtn:active{transform:translateY(1px)}

/* Table / day list */
.sheet{
  max-width:980px; margin:0 auto 120px; padding:0 12px;
}
.row{
  background:var(--card);
  border-radius:14px;
  margin:8px 0;
  padding:10px 10px 6px;
  position:relative;
  box-shadow:var(--shadow);
}
.row .dayline{
  position:absolute; inset:auto 10px 0 10px; height:1px; background:var(--line);
  border-radius:1px;
}
.row-inner{
  display:grid; grid-template-columns:54px 1fr 1fr 76px 120px; gap:10px; align-items:center;
}
.col-day{font-weight:800; color:var(--brand)}
.input, select{
  width:100%; height:44px; border:1px solid var(--line); border-radius:12px; padding:0 12px; font-size:16px; background:#fff;
}
.select-wrap{position:relative}
.select-wrap:after{content:"‚ñæ"; position:absolute; right:12px; top:10px; color:var(--muted)}
.btn-ghost{
  height:44px; border-radius:12px; border:1px dashed var(--line); background:#fff; cursor:pointer;
}
.btn-photo{background:var(--brand); color:#fff; border:0}
.small{font-size:12px}
.today{ outline:2px solid rgba(10,122,93,.2); box-shadow:0 0 0 5px rgba(10,122,93,.05) inset}
.row.today .col-day{color:var(--focus)}

/* Footer action area */
.footer-actions{
  position:sticky; bottom:0; z-index:10; padding:12px;
  margin-top:24px; background:linear-gradient(180deg,rgba(243,247,244,0), var(--bg) 28%, var(--bg));
}
.sign-row{ display:flex; gap:12px; max-width:980px; margin:0 auto; }
.sign-btn{
  flex:1; height:44px; border-radius:999px; border:1px dashed var(--line); background:#fff;
  display:flex; align-items:center; justify-content:center; gap:8px; font-weight:600; cursor:pointer; box-shadow:var(--shadow);
}

/* Settings FAB */
.fab{
  position:fixed; left:16px; bottom:calc(16px + env(safe-area-inset-bottom));
  width:64px; height:64px; border-radius:18px; background:var(--brand); color:#fff; border:0; cursor:pointer;
  box-shadow:0 14px 30px rgba(0,0,0,.22);
  display:grid; place-items:center; z-index:50;
}

/* Drawer */
.drawer{
  position:fixed; left:0; right:0; bottom:-100%; background:#fff; border-radius:20px 20px 0 0;
  box-shadow:0 -18px 40px rgba(0,0,0,.28); padding:18px 16px 22px; transition:bottom .25s ease; z-index:60;
}
.drawer.open{bottom:0}
.drawer h3{margin:0 0 10px}
.group{margin:12px 0}
.label{font-weight:700; margin:8px 0 6px}
.switch{display:flex; align-items:center; gap:8px}
.range{width:100%}

/* Photo menu */
.menu{position:absolute; background:#fff; border-radius:12px; box-shadow:var(--shadow); overflow:hidden}
.menu button{display:block; width:100%; text-align:left; padding:12px 14px; border:0; background:#fff; cursor:pointer}
.menu button + button{border-top:1px solid var(--line)}

/* Modal for signature */
.modal{
  position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); z-index:80;
}
.modal.open{display:grid}
.modal-card{
  width:min(720px,92vw); background:#fff; border-radius:16px; padding:12px; box-shadow:var(--shadow)
}
.canvas-wrap{background:#f9fbfa; border:1px solid var(--line); border-radius:12px; height:320px; display:grid; place-items:center}
.canvas-wrap canvas{ width:100%; height:100%}
.modal-actions{display:flex; justify-content:space-between; gap:8px; margin-top:10px}
.modal-actions .btn{flex:1}

/* Watermark */
.watermark{
  position:fixed; right:14px; bottom:calc(58px + env(safe-area-inset-bottom)); opacity:.4; z-index:0;
  pointer-events:none; user-select:none;
  filter:grayscale(.15);
}
.watermark img{ width:min(42vw,270px); opacity:inherit; }

/* Debug pill */
.debug{
  position:fixed; right:10px; bottom:calc(12px + env(safe-area-inset-bottom));
  background:#000; color:#9ff1cb; padding:8px 10px; border-radius:12px; font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  display:none; max-width:58vw; white-space:pre-wrap
}

/* Responsive shrink on small screens */
@media (max-width:720px){
  .row-inner{ grid-template-columns:52px 1fr 1fr 70px 54px; }
  .summary{grid-template-columns:1fr 1fr auto}
  .btn{padding:10px 14px}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo-badge" id="logoBadge">TN</div>
    <div class="header-title">Th√ºringer Tannenhof ‚Äì Tidsrapport</div>
    <div class="header-actions">
      <button class="btn" id="shareBtn">Dela / Skicka</button>
      <button class="btn btn-dark" id="pdfBtn">PDF</button>
    </div>
  </div>
</header>

<section class="summary">
  <div class="card">
    <div class="hint">Totalt</div>
    <div id="totaltH">0.00</div>
  </div>
  <div class="card">
    <div class="hint">M√•nad</div>
    <div id="monthTitle">oktober 2025</div>
  </div>
  <div class="card nav-arrows shadowless">
    <button class="iconbtn" id="prevM">¬´</button>
    <button class="iconbtn" id="nextM">¬ª</button>
    <button class="btn" id="clearMonth">Rensa denna m√•nad</button>
  </div>
</section>

<main class="sheet" id="sheet"></main>

<div class="footer-actions">
  <div class="sign-row">
    <button class="sign-btn" id="signEmp">‚úçÔ∏è Signera Medarbetare</button>
    <button class="sign-btn" id="signBoss">‚úçÔ∏è Signera Chef</button>
  </div>
</div>

<!-- Settings FAB -->
<button class="fab" id="fab" title="Inst√§llningar">‚öôÔ∏è</button>

<!-- Settings Drawer -->
<aside class="drawer" id="drawer">
  <h3>Inst√§llningar</h3>
  <div class="group">
    <div class="label">V√§lj logga (PNG/JPG)</div>
    <input type="file" id="logoFile" accept="image/png,image/jpeg" />
  </div>
  <div class="group">
    <div class="label">F√∂retagsgr√∂n (HEX)</div>
    <input class="input" id="brandHex" placeholder="#1f5634" />
  </div>
  <div class="group">
    <div class="label">Vattenst√§mpel</div>
    <label class="switch"><input type="checkbox" id="wmToggle" checked /> Synlig</label>
    <div class="label">Genomskinlighet: <span id="wmVal">40%</span></div>
    <input class="range" id="wmRange" type="range" min="0" max="100" step="1" value="40" />
  </div>
  <div class="group">
    <button class="btn" id="debugToggle">Visa/D√∂lj fels√∂kning</button>
  </div>
  <div class="group">
    <button class="btn" id="exportJson">Exportera (JSON)</button>
    <button class="btn" id="importJson">Importera (JSON)</button>
  </div>
  <div class="group">
    <button class="btn" style="background:#ffe9e9" id="clearAll">Rensa ALLT (alla m√•nader)</button>
  </div>
  <div class="group">
    <button class="btn" id="closeDrawer">St√§ng</button>
  </div>
</aside>

<!-- Watermark -->
<div class="watermark" id="wmWrap" aria-hidden="true">
  <img id="wmImg" src="" alt="watermark" />
</div>

<!-- Debug -->
<pre class="debug" id="debugBox"></pre>

<!-- Signature modals -->
<div class="modal" id="sigModalEmp">
  <div class="modal-card">
    <h3>Signera ‚Äì Medarbetare</h3>
    <div class="canvas-wrap"><canvas id="sigCanvasEmp"></canvas></div>
    <div class="modal-actions">
      <button class="btn" id="sigEmpClear">Rensa</button>
      <button class="btn" id="sigEmpSave">Spara</button>
      <button class="btn" id="sigEmpClose">St√§ng</button>
    </div>
  </div>
</div>

<div class="modal" id="sigModalBoss">
  <div class="modal-card">
    <h3>Signera ‚Äì Chef</h3>
    <div class="canvas-wrap"><canvas id="sigCanvasBoss"></canvas></div>
    <div class="modal-actions">
      <button class="btn" id="sigBossClear">Rensa</button>
      <button class="btn" id="sigBossSave">Spara</button>
      <button class="btn" id="sigBossClose">St√§ng</button>
    </div>
  </div>
</div>

<!-- Hidden inputs for photo flow -->
<input id="pickGallery" type="file" accept="image/*" style="display:none" />
<input id="takePhoto" type="file" accept="image/*" capture="environment" style="display:none" />

<script>
/* ------------------ State ------------------ */
const S = {
  year: new Date().getFullYear(),
  month: new Date().getMonth(), // 0-11
  data: {},      // { '2025-10': { d1:{from:'08:00',to:'16:00',break:0, note:'', photos:[...]} } }
  brand: '#1f5634',
  logoDataUrl: null,
  watermark: { visible:true, opacity:0.4, dataUrl:null },
  debug:false
};
const $ = s=>document.querySelector(s);

/* ------------------ Util ------------------ */
const pad=n=>String(n).padStart(2,'0');
const ymKey=(y,m)=>`${y}-${pad(m+1)}`;
const today = new Date();

/* ------------------ Load saved ------------------ */
(function loadSaved(){
  try{
    const save = JSON.parse(localStorage.getItem('tt_timesheet_v3')||'{}');
    Object.assign(S, save, {debug:false});
  }catch(e){}
})();

/* ------------------ Apply brand ------------------ */
function applyBrand(hex){
  if(!/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(hex)) return;
  S.brand = hex;
  document.documentElement.style.setProperty('--brand', hex);
  $('#brandHex').value = hex;
}

/* ------------------ Header logo ------------------ */
function refreshLogo(){
  const badge = $('#logoBadge');
  badge.innerHTML = '';
  if(S.logoDataUrl){
    const img = new Image(); img.src = S.logoDataUrl; badge.appendChild(img);
  }else{
    badge.textContent = 'TN';
  }
  // Watermark image fallback to logo if provided
  const wmImg = $('#wmImg');
  if(S.watermark.dataUrl){ wmImg.src = S.watermark.dataUrl; }
  else if(S.logoDataUrl){ wmImg.src = S.logoDataUrl; }
  else { wmImg.src = ''; }
}

/* ------------------ Build month ------------------ */
function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }
function buildMonth(){
  const y = S.year, m=S.month;
  const key = ymKey(y,m);
  S.data[key] = S.data[key] || {};
  $('#monthTitle').textContent = new Date(y,m,1).toLocaleDateString('sv-SE',{month:'long', year:'numeric'});

  const sheet = $('#sheet'); sheet.innerHTML = '';
  const dmax = daysInMonth(y,m);
  for(let d=1; d<=dmax; d++){
    const row = document.createElement('div'); row.className='row';
    if (today.getFullYear()===y && today.getMonth()===m && today.getDate()===d) row.classList.add('today');

    row.innerHTML = `
      <div class="row-inner">
        <div class="col-day">${d}</div>
        <div class="select-wrap">
          <input class="input" inputmode="numeric" placeholder="Fr√•n" data-k="from" data-d="${d}" />
        </div>
        <div class="select-wrap">
          <input class="input" inputmode="numeric" placeholder="Till" data-k="to" data-d="${d}" />
        </div>
        <div class="select-wrap">
          <input class="input" inputmode="numeric" placeholder="Paus" data-k="break" data-d="${d}" value="0" />
        </div>
        <div style="display:flex; gap:6px; justify-content:flex-end">
          <button class="btn-ghost small" data-note="${d}" title="Anteckning">üìù</button>
          <button class="btn-photo small" data-photo="${d}" title="Foto">üì∑</button>
        </div>
      </div>
      <div class="dayline"></div>
    `;
    sheet.appendChild(row);

    // Attach existing data
    const rec = S.data[key][d] || {};
    row.querySelector('[data-k="from"]').value = rec.from || '';
    row.querySelector('[data-k="to"]').value = rec.to || '';
    row.querySelector('[data-k="break"]').value = rec.break ?? 0;

    // Handlers
    row.querySelectorAll('[data-k]').forEach(inp=>{
      inp.addEventListener('change', ()=>saveField(d, inp.dataset.k, inp.value));
    });

    row.querySelector(`[data-note="${d}"]`).addEventListener('click', ()=> openNote(d));
    row.querySelector(`[data-photo="${d}"]`).addEventListener('click', e=> openPhotoMenu(e.currentTarget, d));
  }
  computeTotal();
  refreshWatermark();
}

/* ------------------ Save field ------------------ */
function ensureRec(d){
  const key=ymKey(S.year,S.month);
  S.data[key] = S.data[key]||{};
  S.data[key][d] = S.data[key][d]||{photos:[]};
  return S.data[key][d];
}
function saveField(d,k,v){
  const rec = ensureRec(d);
  if(k==='break') v = Number(v)||0;
  rec[k]=v;
  persist();
  computeTotal();
}

/* ------------------ Notes ------------------ */
function openNote(d){
  const text = prompt(`Anteckning f√∂r ${d}/${pad(S.month+1)}:`, ensureRec(d).note||'');
  if(text!==null){ saveField(d,'note',text); }
}

/* ------------------ Photo menu ------------------ */
let openMenu;
function openPhotoMenu(btn, d){
  if(openMenu) openMenu.remove();
  const m = document.createElement('div'); m.className='menu';
  const rect = btn.getBoundingClientRect();
  m.style.left = (rect.left-60)+'px';
  m.style.top = (rect.bottom + 6 + window.scrollY)+'px';
  m.innerHTML = `
    <button data-a="view">üëÄ Titta</button>
    <button data-a="pick">üñºÔ∏è V√§lj fr√•n galleri</button>
    <button data-a="take">üì∑ Ta foto</button>
  `;
  document.body.appendChild(m);
  openMenu = m;

  m.querySelectorAll('button').forEach(x=>x.onclick = ()=>{
    const act = x.dataset.a;
    if(act==='view'){
      const photos = ensureRec(d).photos||[];
      if(!photos.length){ alert('Inga foton sparade.'); return; }
      const w = window.open();
      w.document.write('<title>Foton</title>');
      photos.forEach(src=> w.document.write(`<img src="${src}" style="max-width:100%;display:block;margin:8px auto">`));
      w.document.close();
    }else if(act==='pick'){
      const inp = $('#pickGallery'); inp.onchange = e=>{
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{ ensureRec(d).photos.push(reader.result); persist(); e.target.value=''; };
        reader.readAsDataURL(file);
      }; inp.click();
    }else if(act==='take'){
      const inp = $('#takePhoto'); inp.onchange = e=>{
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{ ensureRec(d).photos.push(reader.result); persist(); e.target.value=''; };
        reader.readAsDataURL(file);
      }; inp.click();
    }
    m.remove(); openMenu=null;
  });

  document.addEventListener('click', function once(ev){
    if(!m.contains(ev.target) && ev.target!==btn){ m.remove(); openMenu=null; document.removeEventListener('click', once); }
  });
}

/* ------------------ Total ------------------ */
function parseTime(s){
  const m = /^(\d{1,2}):?(\d{2})$/.exec((s||'').trim());
  if(!m){ return null; }
  let h = parseInt(m[1],10); let mm=parseInt(m[2],10);
  if(h>23||mm>59) return null;
  return h*60+mm;
}
function computeTotal(){
  const key = ymKey(S.year,S.month);
  let mins=0;
  const recs = S.data[key]||{};
  for(const d in recs){
    const r = recs[d]; const a=parseTime(r.from), b=parseTime(r.to);
    if(a!=null && b!=null && b>a){
      mins += (b-a) - (Number(r.break)||0);
    }
  }
  const hours = (mins/60)||0;
  $('#totaltH').textContent = hours.toFixed(2);
}

/* ------------------ Persist ------------------ */
function persist(){
  localStorage.setItem('tt_timesheet_v3', JSON.stringify({
    year:S.year, month:S.month, data:S.data, brand:S.brand,
    logoDataUrl:S.logoDataUrl,
    watermark:S.watermark
  }));
  if(S.debug){ showDebug('Sparat'); }
}

/* ------------------ Watermark ------------------ */
function refreshWatermark(){
  const wrap = $('#wmWrap');
  wrap.style.display = S.watermark.visible ? 'block' : 'none';
  wrap.style.opacity = S.watermark.opacity;
}

/* ------------------ Debug ------------------ */
function showDebug(msg){
  const b = $('#debugBox'); b.style.display='block';
  b.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
}

/* ------------------ Signature (canvas) ------------------ */
function setupSig(modalId, canvasId, saveKey){
  const modal = $(modalId), cvs=$(canvasId);
  let drawing=false, ctx, scale=1;
  function fit(){
    const dpr = window.devicePixelRatio||1;
    const w = cvs.parentElement.clientWidth;
    const h = cvs.parentElement.clientHeight;
    cvs.width = w * dpr; cvs.height = h * dpr; cvs.style.width=w+'px'; cvs.style.height=h+'px';
    ctx = cvs.getContext('2d'); ctx.scale(dpr,dpr);
    ctx.lineWidth=3; ctx.lineCap='round'; ctx.strokeStyle = '#111';
    // existing
    const img = new Image(); img.onload=()=>{ ctx.drawImage(img,0,0,w,h); }; img.src = S[saveKey]||'';
  }
  new ResizeObserver(fit).observe(cvs.parentElement);

  function pos(e){
    const r = cvs.getBoundingClientRect();
    const x = (e.touches? e.touches[0].clientX : e.clientX) - r.left;
    const y = (e.touches? e.touches[0].clientY : e.clientY) - r.top;
    return {x,y};
  }
  cvs.addEventListener('mousedown', e=>{drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y);});
  cvs.addEventListener('mousemove', e=>{ if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke();});
  window.addEventListener('mouseup', ()=> drawing=false);

  cvs.addEventListener('touchstart', e=>{drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y);});
  cvs.addEventListener('touchmove', e=>{ if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke();});
  window.addEventListener('touchend', ()=> drawing=false);

  return {
    open:()=>{ modal.classList.add('open'); fit(); },
    close:()=> modal.classList.remove('open'),
    clear:()=>{ ctx.clearRect(0,0,cvs.width,cvs.height); },
    save:()=>{
      S[saveKey] = cvs.toDataURL('image/png');
      persist(); 
      alert('Signatur sparad.');
    }
  };
}

const sigEmp = setupSig('#sigModalEmp','#sigCanvasEmp','sigEmpData');
const sigBoss= setupSig('#sigModalBoss','#sigCanvasBoss','sigBossData');
$('#signEmp').onclick = ()=> sigEmp.open();
$('#signBoss').onclick = ()=> sigBoss.open();
$('#sigEmpClose').onclick = ()=> sigEmp.close();
$('#sigBossClose').onclick = ()=> sigBoss.close();
$('#sigEmpClear').onclick = ()=> sigEmp.clear();
$('#sigBossClear').onclick = ()=> sigBoss.clear();
$('#sigEmpSave').onclick = ()=> sigEmp.save();
$('#sigBossSave').onclick = ()=> sigBoss.save();

/* ------------------ Settings UI ------------------ */
$('#fab').onclick = ()=> $('#drawer').classList.add('open');
$('#closeDrawer').onclick = ()=> $('#drawer').classList.remove('open');

$('#brandHex').onchange = e=>{ applyBrand(e.target.value.trim()); persist(); };

$('#logoFile').onchange = e=>{
  const f=e.target.files[0]; if(!f) return;
  const rd=new FileReader();
  rd.onload = ()=>{
    S.logoDataUrl = rd.result;
    // default watermark = same
    if(!S.watermark.dataUrl) S.watermark.dataUrl = rd.result;
    refreshLogo(); refreshWatermark(); persist();
  };
  rd.readAsDataURL(f);
};

$('#wmToggle').onchange = e=>{ S.watermark.visible = e.target.checked; refreshWatermark(); persist(); };
$('#wmRange').oninput = e=>{ const v=Number(e.target.value)/100; S.watermark.opacity=v; $('#wmVal').textContent=Math.round(v*100)+'%'; refreshWatermark(); persist(); };

$('#debugToggle').onclick = ()=>{ S.debug=!S.debug; $('#debugBox').style.display = S.debug?'block':'none'; };
$('#exportJson').onclick = ()=>{
  const blob = new Blob([localStorage.getItem('tt_timesheet_v3')||'{}'], {type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='tt_timesheet_backup.json'; a.click();
};
$('#importJson').onclick = ()=>{
  const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange = e=>{
    const f = e.target.files[0]; if(!f) return;
    const rd = new FileReader();
    rd.onload = ()=>{
      localStorage.setItem('tt_timesheet_v3', rd.result);
      location.reload();
    };
    rd.readAsText(f);
  };
  inp.click();
};
$('#clearAll').onclick = ()=>{ if(confirm('Rensa ALLT (alla m√•nader)?')){ localStorage.removeItem('tt_timesheet_v3'); location.reload(); } };

/* Month nav + clear */
$('#prevM').onclick = ()=>{ if(S.month===0){S.month=11; S.year--;} else S.month--; persist(); buildMonth(); };
$('#nextM').onclick = ()=>{ if(S.month===11){S.month=0; S.year++;} else S.month++; persist(); buildMonth(); };
$('#clearMonth').onclick = ()=>{
  const key = ymKey(S.year,S.month);
  if(confirm('Rensa denna m√•nad?')){ delete S.data[key]; persist(); buildMonth(); }
};

/* Share/pdf placeholders */
$('#shareBtn').onclick = ()=> alert('Dela / Skicka ‚Äì implementeras med Web Share / e-post enligt vad du vill ha.');
$('#pdfBtn').onclick   = ()=> alert('PDF ‚Äì kan exporteras via html2canvas/jspdf om du vill, s√§g till s√• l√§gger jag in.');

/* ------------------ Init ------------------ */
applyBrand(S.brand || '#1f5634');
refreshLogo();
$('#wmToggle').checked = S.watermark.visible!==false;
$('#wmRange').value = Math.round((S.watermark.opacity ?? 0.4)*100);
$('#wmVal').textContent = Math.round((S.watermark.opacity ?? 0.4)*100)+'%';
buildMonth();

/* Extra bottenluft s√• FAB inte t√§cker sista raden */
document.body.style.paddingBottom = '110px';

</script>
</body>
</html>
