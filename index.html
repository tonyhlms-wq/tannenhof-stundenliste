<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tannenhofs tidtabell</title>
  <meta name="theme-color" content="#2e7d32" />
  <style>
    :root{
      --bg:#f4f8f4;
      --card:#ffffff;
      --text:#1f3b1f;
      --muted:#4a6b4a;
      --brand:#2e7d32;
      --brand-2:#205c24;
      --danger:#b00020;
      --ring: rgba(46,125,50,.25);
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:var(--sans);line-height:1.4;
    }
    header{
      background:linear-gradient(0deg,var(--brand),var(--brand-2));
      color:#fff;padding:18px 16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;
      position:sticky;top:0;z-index:10;
    }
    header .logo{font-size:28px;line-height:1}
    header h1{margin:0;font-size:20px;font-weight:650;letter-spacing:.3px}
    header .right{margin-left:auto;display:flex;align-items:center;gap:8px}
    select, input[type="number"], input[type="time"], input[type="text"], button{
      font:inherit;border:1px solid #d2e3d2;border-radius:10px;padding:10px 12px;background:#fff;color:var(--text);
    }
    select:focus, input:focus, button:focus{outline:3px solid var(--ring)}
    main{max-width:980px;margin:18px auto;padding:0 12px}
    .card{background:var(--card);border:1px solid #e5f0e5;border-radius:14px;box-shadow:0 1px 6px rgba(0,0,0,.04)}
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .controls{padding:12px}
    .controls .row > *{margin-right:6px}
    .company{
      display:flex;align-items:center;gap:10px;color:#fff;background:#2e7d32;padding:10px 12px;border-radius:10px
    }
    .company .name{font-weight:700}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{position:sticky;top:0;background:#eef7ee;border-bottom:1px solid #dbeadb;padding:10px 6px;text-align:left}
    tbody td{border-bottom:1px solid #eef2ee;padding:8px 6px}
    tbody tr:hover{background:#f7fbf7}
    td.num{font-family:var(--mono);text-align:center;width:52px}
    td.week{color:var(--muted);width:84px}
    td.total{font-family:var(--mono);font-weight:600}
    tfoot td{padding:12px 8px}
    .summary{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
    .badge{background:#eef7ee;border:1px solid #d7ead7;padding:10px;border-radius:12px;text-align:center}
    .danger{color:#b00020}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.secondary{background:#e7f2e7;color:var(--brand-2);border:1px solid #cfe4cf}
    .btn.ghost{background:transparent;border:1px dashed #cfe4cf;color:var(--brand-2)}
    .note{width:100%}
    @media (max-width:760px){
      thead .opt-col{display:none}
      tbody .opt-col{display:none}
      td.week{width:auto}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">🌲</div>
    <h1 id="t-title">Tannenhofs tidtabell</h1>
    <div class="right">
      <label for="lang" id="t-lang">Språk:</label>
      <select id="lang">
        <option value="sv">Svenska</option>
        <option value="de">Deutsch</option>
      </select>
    </div>
    <div class="right company" title="Företagsläge är låst">
      <div>🏢</div>
      <div class="name">THÜRINGER TANNENHOF</div>
    </div>
  </header>

  <main>
    <section class="card controls">
      <div class="row">
        <label id="t-month" for="month">Månad</label>
        <select id="month"></select>

        <label id="t-year" for="year">År</label>
        <input id="year" type="number" min="2000" max="2100" style="width:110px"/>

        <label id="t-target" for="target">Arbetstid/dag</label>
        <input id="target" type="number" step="0.25" min="0" value="8" style="width:110px"/>

        <div class="actions" style="margin-left:auto">
          <button class="btn secondary" id="btn-clear">Rensa månad</button>
          <button class="btn" id="btn-print">Skriv ut / PDF</button>
        </div>
      </div>
    </section>

    <section class="card">
      <table id="sheet">
        <thead>
          <tr>
            <th class="num">#</th>
            <th id="t-weekday">Dag</th>
            <th id="t-start">Från</th>
            <th id="t-end">Till</th>
            <th id="t-break">Rast (min)</th>
            <th id="t-total">Totalt</th>
            <th class="opt-col" id="t-note">Anteckning</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot>
          <tr>
            <td colspan="7">
              <div class="summary">
                <div class="badge">
                  <div id="t-sum-label">Summa timmar</div>
                  <div id="sum-hours" style="font-family:var(--mono);font-weight:700;font-size:18px">00:00</div>
                </div>
                <div class="badge">
                  <div id="t-longest-label">Längsta dag</div>
                  <div id="longest" style="font-family:var(--mono);font-weight:700">00:00</div>
                </div>
                <div class="badge">
                  <div id="t-avg-label">Medel / dag</div>
                  <div id="avg" style="font-family:var(--mono);font-weight:700">00:00</div>
                </div>
              </div>
            </td>
          </tr>
        </tfoot>
      </table>
    </section>
    <p style="text-align:center;color:#6d8a6d;margin:22px 0">© 2025 Tony Holmström</p>
  </main>

  <script>
    // ---- i18n ----
    const I18N = {
      sv: {
        title:"Tannenhofs tidtabell",
        lang:"Språk:",
        month:"Månad", year:"År", target:"Arbetstid/dag",
        weekday:"Dag", start:"Från", end:"Till", break:"Rast (min)", total:"Totalt", note:"Anteckning",
        sum:"Summa timmar", longest:"Längsta dag", avg:"Medel / dag",
        clear:"Rensa månad", print:"Skriv ut / PDF",
        days:["Sön","Mån","Tis","Ons","Tors","Fre","Lör"],
        months:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"]
      },
      de: {
        title:"Tannenhof Stundentabelle",
        lang:"Sprache:",
        month:"Monat", year:"Jahr", target:"Arbeitszeit/Tag",
        weekday:"Wochentag", start:"Von", end:"Bis", break:"Pause (Min)", total:"Summe", note:"Notiz",
        sum:"Stunden gesamt", longest:"Längster Tag", avg:"Schnitt / Tag",
        clear:"Monat leeren", print:"Drucken / PDF",
        days:["So","Mo","Di","Mi","Do","Fr","Sa"],
        months:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]
      }
    };

    const qs = sel => document.querySelector(sel);
    const tbody = qs('#tbody');
    const monthSel = qs('#month');
    const yearInp = qs('#year');
    const targetInp = qs('#target');
    const langSel = qs('#lang');

    const t = (k)=>I18N[langSel.value][k];

    // Fill month selector
    function fillMonths(){
      monthSel.innerHTML = "";
      I18N[langSel.value].months.forEach((m,i)=>{
        const opt = document.createElement('option');
        opt.value = i+1; opt.textContent = m;
        monthSel.appendChild(opt);
      });
    }

    function daysInMonth(y,m){return new Date(y,m,0).getDate();}

    function timeToMin(v){
      if(!v) return 0;
      const [h,mm] = v.split(':').map(n=>parseInt(n||0,10));
      return h*60 + mm;
    }
    function minToHHMM(mins){
      const m = Math.max(0, Math.round(mins));
      const h = Math.floor(m/60);
      const mm = (m%60).toString().padStart(2,'0');
      return `${h.toString().padStart(2,'0')}:${mm}`;
    }

    function key(){ return `tannenhof:${yearInp.value}-${monthSel.value}`; }

    function save(){
      const rows = [...tbody.querySelectorAll('tr')].map(tr=>{
        return {
          start: tr.querySelector('input[data-k="start"]').value,
          end: tr.querySelector('input[data-k="end"]').value,
          brk: tr.querySelector('input[data-k="brk"]').value,
          note: tr.querySelector('input[data-k="note"]').value
        };
      });
      localStorage.setItem(key(), JSON.stringify({rows, target: targetInp.value}));
    }
    function load(){
      const raw = localStorage.getItem(key());
      if(!raw) return;
      try{
        const obj = JSON.parse(raw);
        targetInp.value = obj.target ?? targetInp.value;
        const trs = [...tbody.querySelectorAll('tr')];
        obj.rows?.forEach((r,idx)=>{
          const tr = trs[idx]; if(!tr) return;
          tr.querySelector('input[data-k="start"]').value = r.start||"";
          tr.querySelector('input[data-k="end"]').value   = r.end||"";
          tr.querySelector('input[data-k="brk"]').value   = r.brk||"";
          tr.querySelector('input[data-k="note"]').value  = r.note||"";
        });
      }catch{}
    }

    function compute(){
      let sum=0, max=0;
      const trs = [...tbody.querySelectorAll('tr')];
      trs.forEach(tr=>{
        const s = timeToMin(tr.querySelector('input[data-k="start"]').value);
        const e = timeToMin(tr.querySelector('input[data-k="end"]').value);
        const b = parseInt(tr.querySelector('input[data-k="brk"]').value||0,10);
        let d = Math.max(0, e - s - (isNaN(b)?0:b));
        tr.querySelector('.total').textContent = minToHHMM(d);
        sum += d; if(d>max) max=d;
      });
      qs('#sum-hours').textContent = minToHHMM(sum);
      qs('#longest').textContent = minToHHMM(max);
      qs('#avg').textContent = trs.length? minToHHMM(sum/trs.length):"00:00";
      save();
    }

    function gen(){
      tbody.innerHTML = "";
      const y = parseInt(yearInp.value,10);
      const m = parseInt(monthSel.value,10);
      const n = daysInMonth(y,m);
      for(let d=1; d<=n; d++){
        const date = new Date(y, m-1, d);
        const tr = document.createElement('tr');

        const tdNum = document.createElement('td'); tdNum.className="num"; tdNum.textContent=d;
        const tdWeek = document.createElement('td'); tdWeek.className="week";
        tdWeek.textContent = I18N[langSel.value].days[date.getDay()];

        const mkInput = (k,type="time",extra={})=>{
          const inp = document.createElement('input');
          inp.type = type; inp.setAttribute('data-k',k);
          if(type==="number"){ inp.min=0; inp.step=5; inp.style.width='90px'; }
          if(type==="text"){ inp.className='note'; }
          inp.addEventListener('input', compute);
          return inp;
        };

        const tdStart = document.createElement('td'); tdStart.appendChild(mkInput("start"));
        const tdEnd   = document.createElement('td'); tdEnd.appendChild(mkInput("end"));
        const tdBrk   = document.createElement('td'); tdBrk.appendChild(mkInput("brk","number"));
        const tdTot   = document.createElement('td'); tdTot.className="total"; tdTot.textContent="00:00";
        const tdNote  = document.createElement('td'); tdNote.className="opt-col"; tdNote.appendChild(mkInput("note","text"));

        tr.append(tdNum, tdWeek, tdStart, tdEnd, tdBrk, tdTot, tdNote);
        tbody.appendChild(tr);
      }
      load();
      compute();
    }

    function applyTexts(){
      qs('#t-title').textContent = t('title');
      qs('#t-lang').textContent = t('lang');
      qs('#t-month').textContent = t('month');
      qs('#t-year').textContent = t('year');
      qs('#t-target').textContent = t('target');
      qs('#t-weekday').textContent = t('weekday');
      qs('#t-start').textContent = t('start');
      qs('#t-end').textContent = t('end');
      qs('#t-break').textContent = t('break');
      qs('#t-total').textContent = t('total');
      qs('#t-note').textContent = t('note');
      qs('#t-sum-label').textContent = t('sum');
      qs('#t-longest-label').textContent = t('longest');
      qs('#t-avg-label').textContent = t('avg');
      qs('#btn-clear').textContent = t('clear');
      qs('#btn-print').textContent = t('print');
    }

    // Events
    monthSel.addEventListener('change', ()=>{gen()});
    yearInp.addEventListener('change', ()=>{gen()});
    targetInp.addEventListener('input', save);
    qs('#btn-clear').addEventListener('click', ()=>{
      if(confirm(langSel.value==='de' ? 'Monat leeren?' : 'Rensa denna månad?')){
        localStorage.removeItem(key());
        gen();
      }
    });
    qs('#btn-print').addEventListener('click', ()=>window.print());
    langSel.addEventListener('change', ()=>{
      fillMonths(); applyTexts(); gen();
      monthSel.value = new Date().getMonth()+1; // håll samma månadstalsindex
    });

    // Init
    (function init(){
      // fyll månader
      fillMonths();
      // default: nuvarande månad/år
      const now = new Date();
      monthSel.value = now.getMonth()+1;
      yearInp.value = now.getFullYear();
      applyTexts();
      gen();
    })();
  </script>
</body>
</html>
